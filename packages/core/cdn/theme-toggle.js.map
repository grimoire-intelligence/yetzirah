{"version":3,"sources":["../src/utils/register.js","../src/toggle.js","../src/theme-toggle.js"],"names":["register","name","constructor","YtzToggle","#setup","#updateState","#handleClick","#handleKeydown","oldVal","newVal","e","willCheck","value","DEFAULT_STORAGE_KEY","DARK_CLASS","THEME_ATTR","YtzThemeToggle","#toggle","#initializeTheme","#handleChange","savedTheme","#loadTheme","prefersDark","isDark","#applyTheme","#updateToggle","#saveTheme","root","theme"],"mappings":"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","file":"theme-toggle.js","sourcesContent":["/**\r\n * Idempotent custom element registration utility.\r\n * Prevents duplicate registration errors when scripts load multiple times.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/register\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Register a custom element if not already registered.\r\n * Safe to call multiple times with the same name.\r\n *\r\n * @param {string} name - Custom element tag name (e.g., 'ytz-button')\r\n * @param {CustomElementConstructor} constructor - The element class\r\n */\r\nexport function register(name, constructor) {\r\n  if (!customElements.get(name)) {\r\n    customElements.define(name, constructor)\r\n  }\r\n}\r\n","/**\r\n * ytz-toggle - Switch/Toggle Web Component.\r\n * A toggle switch with checkbox semantics and aria-checked.\r\n *\r\n * @module @grimoire/yetzirah-core/toggle\r\n * @example\r\n * <ytz-toggle>Enable notifications</ytz-toggle>\r\n *\r\n * @example\r\n * // Initially checked\r\n * <ytz-toggle checked>Dark mode</ytz-toggle>\r\n *\r\n * @example\r\n * // Disabled\r\n * <ytz-toggle disabled>Premium feature</ytz-toggle>\r\n */\r\n\r\nimport { register } from './utils/register.js'\r\n\r\n/**\r\n * @class YtzToggle\r\n * @extends HTMLElement\r\n */\r\nclass YtzToggle extends HTMLElement {\r\n  static observedAttributes = ['checked', 'disabled']\r\n\r\n  connectedCallback() {\r\n    this.#setup()\r\n    this.#updateState()\r\n  }\r\n\r\n  #setup() {\r\n    // Set role and make focusable\r\n    this.setAttribute('role', 'switch')\r\n    if (!this.hasAttribute('tabindex')) {\r\n      this.setAttribute('tabindex', '0')\r\n    }\r\n\r\n    // Event listeners\r\n    this.addEventListener('click', this.#handleClick)\r\n    this.addEventListener('keydown', this.#handleKeydown)\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.removeEventListener('click', this.#handleClick)\r\n    this.removeEventListener('keydown', this.#handleKeydown)\r\n  }\r\n\r\n  attributeChangedCallback(name, oldVal, newVal) {\r\n    if (this.isConnected) {\r\n      this.#updateState()\r\n    }\r\n  }\r\n\r\n  #handleClick = () => {\r\n    if (this.disabled) return\r\n    this.toggle()\r\n  }\r\n\r\n  #handleKeydown = (e) => {\r\n    if (this.disabled) return\r\n\r\n    if (e.key === ' ' || e.key === 'Enter') {\r\n      e.preventDefault()\r\n      this.toggle()\r\n    }\r\n  }\r\n\r\n  #updateState() {\r\n    this.setAttribute('aria-checked', String(this.checked))\r\n    this.setAttribute('aria-disabled', String(this.disabled))\r\n  }\r\n\r\n  /**\r\n   * Toggle the checked state.\r\n   * Dispatches a 'change' event with the new state.\r\n   */\r\n  toggle() {\r\n    const willCheck = !this.checked\r\n\r\n    if (willCheck) {\r\n      this.setAttribute('checked', '')\r\n    } else {\r\n      this.removeAttribute('checked')\r\n    }\r\n\r\n    this.dispatchEvent(new CustomEvent('change', {\r\n      bubbles: true,\r\n      detail: { checked: willCheck }\r\n    }))\r\n  }\r\n\r\n  /**\r\n   * Get/set the checked state.\r\n   * @type {boolean}\r\n   */\r\n  get checked() {\r\n    return this.hasAttribute('checked')\r\n  }\r\n\r\n  set checked(value) {\r\n    if (value) {\r\n      this.setAttribute('checked', '')\r\n    } else {\r\n      this.removeAttribute('checked')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get/set the disabled state.\r\n   * @type {boolean}\r\n   */\r\n  get disabled() {\r\n    return this.hasAttribute('disabled')\r\n  }\r\n\r\n  set disabled(value) {\r\n    if (value) {\r\n      this.setAttribute('disabled', '')\r\n    } else {\r\n      this.removeAttribute('disabled')\r\n    }\r\n  }\r\n}\r\n\r\nregister('ytz-toggle', YtzToggle)\r\n\r\nexport { YtzToggle }\r\n","/**\n * ytz-theme-toggle - Theme switching Web Component.\n * A toggle switch that controls light/dark theme with persistence.\n *\n * @module @grimoire/yetzirah-core/theme-toggle\n * @example\n * <ytz-theme-toggle></ytz-theme-toggle>\n *\n * @example\n * // With custom storage key\n * <ytz-theme-toggle storage-key=\"my-app-theme\"></ytz-theme-toggle>\n *\n * @example\n * // Without persistence\n * <ytz-theme-toggle no-persist></ytz-theme-toggle>\n */\n\nimport './toggle.js'\nimport { register } from './utils/register.js'\n\n/** @type {string} Default localStorage key */\nconst DEFAULT_STORAGE_KEY = 'yetzirah-theme'\n\n/** @type {string} CSS class applied to document for dark mode */\nconst DARK_CLASS = 'dark-mode'\n\n/** @type {string} Data attribute for theme */\nconst THEME_ATTR = 'data-theme'\n\n/**\n * @class YtzThemeToggle\n * @extends HTMLElement\n */\nclass YtzThemeToggle extends HTMLElement {\n  static observedAttributes = ['storage-key', 'no-persist']\n\n  /** @type {HTMLElement|null} */\n  #toggle = null\n\n  connectedCallback() {\n    this.#setup()\n    this.#initializeTheme()\n  }\n\n  disconnectedCallback() {\n    this.#toggle?.removeEventListener('change', this.#handleChange)\n  }\n\n  attributeChangedCallback(name, oldVal, newVal) {\n    if (this.isConnected && name === 'storage-key') {\n      this.#initializeTheme()\n    }\n  }\n\n  #setup() {\n    // Create inner toggle if not present\n    if (!this.#toggle) {\n      this.#toggle = document.createElement('ytz-toggle')\n      this.#toggle.setAttribute('aria-label', 'Toggle dark mode')\n\n      // Move existing children into toggle as label\n      while (this.firstChild) {\n        this.#toggle.appendChild(this.firstChild)\n      }\n\n      // Default label if no children provided\n      // Use hasChildNodes() instead of textContent to preserve element children like styling spans\n      if (!this.#toggle.hasChildNodes()) {\n        this.#toggle.textContent = 'Dark mode'\n      }\n\n      this.appendChild(this.#toggle)\n    }\n\n    this.#toggle.addEventListener('change', this.#handleChange)\n  }\n\n  #initializeTheme() {\n    const savedTheme = this.#loadTheme()\n    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n\n    // Determine initial theme: saved > system preference > light\n    const isDark = savedTheme === 'dark' || (savedTheme === null && prefersDark)\n\n    this.#applyTheme(isDark)\n    this.#updateToggle(isDark)\n\n    // Listen for system preference changes\n    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {\n      if (!this.#loadTheme()) {\n        // Only respond to system changes if no saved preference\n        this.#applyTheme(e.matches)\n        this.#updateToggle(e.matches)\n      }\n    })\n  }\n\n  #handleChange = (e) => {\n    const isDark = e.detail.checked\n    this.#applyTheme(isDark)\n    this.#saveTheme(isDark ? 'dark' : 'light')\n\n    this.dispatchEvent(new CustomEvent('themechange', {\n      bubbles: true,\n      detail: { theme: isDark ? 'dark' : 'light', isDark }\n    }))\n  }\n\n  #applyTheme(isDark) {\n    const root = document.documentElement\n\n    if (isDark) {\n      root.classList.add(DARK_CLASS)\n      root.setAttribute(THEME_ATTR, 'dark')\n    } else {\n      root.classList.remove(DARK_CLASS)\n      root.setAttribute(THEME_ATTR, 'light')\n    }\n  }\n\n  #updateToggle(isDark) {\n    if (!this.#toggle) return\n\n    if (isDark) {\n      this.#toggle.setAttribute('checked', '')\n    } else {\n      this.#toggle.removeAttribute('checked')\n    }\n  }\n\n  #loadTheme() {\n    if (this.hasAttribute('no-persist')) return null\n\n    try {\n      return localStorage.getItem(this.storageKey)\n    } catch {\n      // localStorage may be unavailable\n      return null\n    }\n  }\n\n  #saveTheme(theme) {\n    if (this.hasAttribute('no-persist')) return\n\n    try {\n      localStorage.setItem(this.storageKey, theme)\n    } catch {\n      // localStorage may be unavailable\n    }\n  }\n\n  /**\n   * Get the storage key for theme persistence.\n   * @type {string}\n   */\n  get storageKey() {\n    return this.getAttribute('storage-key') || DEFAULT_STORAGE_KEY\n  }\n\n  set storageKey(value) {\n    this.setAttribute('storage-key', value)\n  }\n\n  /**\n   * Get the current theme.\n   * @type {'light'|'dark'}\n   */\n  get theme() {\n    return document.documentElement.classList.contains(DARK_CLASS) ? 'dark' : 'light'\n  }\n\n  /**\n   * Set the theme programmatically.\n   * @param {'light'|'dark'} value\n   */\n  set theme(value) {\n    const isDark = value === 'dark'\n    this.#applyTheme(isDark)\n    this.#updateToggle(isDark)\n    this.#saveTheme(value)\n  }\n\n  /**\n   * Check if dark mode is active.\n   * @type {boolean}\n   */\n  get isDark() {\n    return this.theme === 'dark'\n  }\n\n  /**\n   * Toggle the theme.\n   */\n  toggle() {\n    this.theme = this.isDark ? 'light' : 'dark'\n  }\n}\n\nregister('ytz-theme-toggle', YtzThemeToggle)\n\nexport { YtzThemeToggle }\n"]}