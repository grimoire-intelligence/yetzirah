{"version":3,"sources":["../src/utils/focus-trap.js","../src/drawer.js"],"names":["FOCUSABLE","createFocusTrap","container","handleKeydown","e","focusable","el","first","last","VALID_ANCHORS","YtzDrawer","#previousFocus","#focusTrap","#previousOverflow","#handleBackdropClick","#cleanup","name","oldVal","newVal","#open","#close","#handleEscape","firstFocusable","value"],"mappings":"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","file":"drawer.js","sourcesContent":["/**\r\n * Focus trap utility for modals/dialogs.\r\n * Keeps focus within a container element.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/focus-trap\r\n * @internal Not exported from package\r\n */\r\n\r\n/** @type {string} Selector for focusable elements */\r\nconst FOCUSABLE = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\r\n\r\n/**\r\n * Creates a focus trap for a container element.\r\n *\r\n * @param {HTMLElement} container - Element to trap focus within\r\n * @returns {{ activate: () => void, deactivate: () => void }}\r\n */\r\nexport function createFocusTrap(container) {\r\n  /** @param {KeyboardEvent} e */\r\n  function handleKeydown(e) {\r\n    if (e.key !== 'Tab') return\r\n\r\n    const focusable = [...container.querySelectorAll(FOCUSABLE)]\r\n      .filter(el => !el.hidden && !el.closest('[hidden]')) // visible only\r\n\r\n    if (focusable.length === 0) return\r\n\r\n    const first = focusable[0]\r\n    const last = focusable[focusable.length - 1]\r\n\r\n    if (e.shiftKey && document.activeElement === first) {\r\n      e.preventDefault()\r\n      last.focus()\r\n    } else if (!e.shiftKey && document.activeElement === last) {\r\n      e.preventDefault()\r\n      first.focus()\r\n    }\r\n  }\r\n\r\n  return {\r\n    activate() {\r\n      container.addEventListener('keydown', handleKeydown)\r\n    },\r\n    deactivate() {\r\n      container.removeEventListener('keydown', handleKeydown)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * ytz-drawer - Slide-in panel Web Component.\r\n * Inherits modal behavior: focus trap, scroll lock, escape-to-close, backdrop dismiss.\r\n *\r\n * @module @grimoire/yetzirah-core/drawer\r\n * @example\r\n * <ytz-drawer id=\"menu\" anchor=\"left\" class=\"w5 h-100 bg-white shadow-2\">\r\n *   <nav class=\"pa4\">\r\n *     <a href=\"/home\">Home</a>\r\n *   </nav>\r\n *   <button onclick=\"this.closest('ytz-drawer').close()\">Close</button>\r\n * </ytz-drawer>\r\n *\r\n * @example\r\n * // Open drawer\r\n * document.getElementById('menu').open = true\r\n *\r\n * @example\r\n * // Different anchors\r\n * <ytz-drawer anchor=\"right\">...</ytz-drawer>\r\n * <ytz-drawer anchor=\"top\">...</ytz-drawer>\r\n * <ytz-drawer anchor=\"bottom\">...</ytz-drawer>\r\n */\r\n\r\nimport { createFocusTrap } from './utils/focus-trap.js'\r\n\r\n/** @type {string} Selector for focusable elements */\r\nconst FOCUSABLE = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\r\n\r\n/** @type {string[]} Valid anchor positions */\r\nconst VALID_ANCHORS = ['left', 'right', 'top', 'bottom']\r\n\r\n/**\r\n * @class YtzDrawer\r\n * @extends HTMLElement\r\n */\r\nclass YtzDrawer extends HTMLElement {\r\n  static observedAttributes = ['open', 'anchor']\r\n\r\n  /** @type {HTMLElement|null} */\r\n  #previousFocus = null\r\n  /** @type {{ activate: () => void, deactivate: () => void }|null} */\r\n  #focusTrap = null\r\n  /** @type {string} */\r\n  #previousOverflow = ''\r\n\r\n  connectedCallback() {\r\n    this.setAttribute('role', 'dialog')\r\n    this.setAttribute('aria-modal', 'true')\r\n    this.hidden = !this.hasAttribute('open')\r\n\r\n    if (!this.hasAttribute('anchor')) {\r\n      this.setAttribute('anchor', 'left')\r\n    }\r\n\r\n    this.addEventListener('click', this.#handleBackdropClick)\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.removeEventListener('click', this.#handleBackdropClick)\r\n    this.#cleanup()\r\n  }\r\n\r\n  attributeChangedCallback(name, oldVal, newVal) {\r\n    if (name === 'open' && this.isConnected) {\r\n      newVal !== null ? this.#open() : this.#close()\r\n    }\r\n    if (name === 'anchor' && newVal && !VALID_ANCHORS.includes(newVal)) {\r\n      this.setAttribute('anchor', 'left')\r\n    }\r\n  }\r\n\r\n  #open() {\r\n    this.#previousFocus = /** @type {HTMLElement} */ (document.activeElement)\r\n    this.hidden = false\r\n    this.#previousOverflow = document.body.style.overflow\r\n    document.body.style.overflow = 'hidden'\r\n    this.#focusTrap = createFocusTrap(this)\r\n    this.#focusTrap.activate()\r\n    document.addEventListener('keydown', this.#handleEscape)\r\n\r\n    requestAnimationFrame(() => {\r\n      const firstFocusable = this.querySelector(FOCUSABLE)\r\n      if (firstFocusable) {\r\n        /** @type {HTMLElement} */ (firstFocusable).focus()\r\n      } else {\r\n        this.setAttribute('tabindex', '-1')\r\n        this.focus()\r\n      }\r\n    })\r\n  }\r\n\r\n  #close() {\r\n    this.hidden = true\r\n    this.#cleanup()\r\n    this.dispatchEvent(new CustomEvent('close', { bubbles: true }))\r\n  }\r\n\r\n  #cleanup() {\r\n    document.body.style.overflow = this.#previousOverflow\r\n    this.#focusTrap?.deactivate()\r\n    this.#focusTrap = null\r\n    document.removeEventListener('keydown', this.#handleEscape)\r\n    this.#previousFocus?.focus()\r\n    this.#previousFocus = null\r\n  }\r\n\r\n  /** @param {KeyboardEvent} e */\r\n  #handleEscape = (e) => {\r\n    if (e.key === 'Escape' && this.hasAttribute('open')) {\r\n      e.preventDefault()\r\n      this.removeAttribute('open')\r\n    }\r\n  }\r\n\r\n  /** @param {MouseEvent} e */\r\n  #handleBackdropClick = (e) => {\r\n    if (e.target === this && !this.hasAttribute('static')) {\r\n      this.removeAttribute('open')\r\n    }\r\n  }\r\n\r\n  /** @type {boolean} */\r\n  get open() {\r\n    return this.hasAttribute('open')\r\n  }\r\n\r\n  set open(value) {\r\n    value ? this.setAttribute('open', '') : this.removeAttribute('open')\r\n  }\r\n\r\n  /** @type {'left'|'right'|'top'|'bottom'} */\r\n  get anchor() {\r\n    return /** @type {'left'|'right'|'top'|'bottom'} */ (this.getAttribute('anchor') || 'left')\r\n  }\r\n\r\n  set anchor(value) {\r\n    if (VALID_ANCHORS.includes(value)) this.setAttribute('anchor', value)\r\n  }\r\n\r\n  /** Close the drawer programmatically. */\r\n  close() {\r\n    this.removeAttribute('open')\r\n  }\r\n\r\n  /** Show the drawer programmatically. */\r\n  show() {\r\n    this.setAttribute('open', '')\r\n  }\r\n}\r\n\r\ncustomElements.define('ytz-drawer', YtzDrawer)\r\n\r\nexport { YtzDrawer }\r\n"]}