{"version":3,"sources":["../src/utils/focus-trap.js","../src/utils/register.js","../src/drawer.js"],"names":["FOCUSABLE","createFocusTrap","container","handleKeydown","e","focusable","el","first","last","register","name","constructor","VALID_ANCHORS","YtzDrawer","#previousFocus","#focusTrap","#previousOverflow","#handleBackdropClick","#cleanup","oldVal","newVal","#open","#close","#handleEscape","firstFocusable","value"],"mappings":"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","file":"drawer.js","sourcesContent":["/**\n * Focus trap utility for modals/dialogs.\n * Keeps focus within a container element.\n *\n * @module @grimoire/yetzirah-core/utils/focus-trap\n * @internal Not exported from package\n */\n\n/** @type {string} Selector for focusable elements */\nconst FOCUSABLE = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\n\n/**\n * Creates a focus trap for a container element.\n *\n * @param {HTMLElement} container - Element to trap focus within\n * @returns {{ activate: () => void, deactivate: () => void }}\n */\nexport function createFocusTrap(container) {\n  /** @param {KeyboardEvent} e */\n  function handleKeydown(e) {\n    if (e.key !== 'Tab') return\n\n    const focusable = [...container.querySelectorAll(FOCUSABLE)]\n      .filter(el => !el.hidden && !el.closest('[hidden]')) // visible only\n\n    if (focusable.length === 0) return\n\n    const first = focusable[0]\n    const last = focusable[focusable.length - 1]\n\n    if (e.shiftKey && document.activeElement === first) {\n      e.preventDefault()\n      last.focus()\n    } else if (!e.shiftKey && document.activeElement === last) {\n      e.preventDefault()\n      first.focus()\n    }\n  }\n\n  return {\n    activate() {\n      container.addEventListener('keydown', handleKeydown)\n    },\n    deactivate() {\n      container.removeEventListener('keydown', handleKeydown)\n    }\n  }\n}\n","/**\n * Idempotent custom element registration utility.\n * Prevents duplicate registration errors when scripts load multiple times.\n *\n * @module @grimoire/yetzirah-core/utils/register\n * @internal Not exported from package\n */\n\n/**\n * Register a custom element if not already registered.\n * Safe to call multiple times with the same name.\n *\n * @param {string} name - Custom element tag name (e.g., 'ytz-button')\n * @param {CustomElementConstructor} constructor - The element class\n */\nexport function register(name, constructor) {\n  if (!customElements.get(name)) {\n    customElements.define(name, constructor)\n  }\n}\n","/**\n * ytz-drawer - Slide-in panel Web Component.\n * Inherits modal behavior: focus trap, scroll lock, escape-to-close, backdrop dismiss.\n *\n * @module @grimoire/yetzirah-core/drawer\n * @example\n * <ytz-drawer id=\"menu\" anchor=\"left\" class=\"w5 h-100 bg-white shadow-2\">\n *   <nav class=\"pa4\">\n *     <a href=\"/home\">Home</a>\n *   </nav>\n *   <button onclick=\"this.closest('ytz-drawer').close()\">Close</button>\n * </ytz-drawer>\n *\n * @example\n * // Open drawer\n * document.getElementById('menu').open = true\n *\n * @example\n * // Different anchors\n * <ytz-drawer anchor=\"right\">...</ytz-drawer>\n * <ytz-drawer anchor=\"top\">...</ytz-drawer>\n * <ytz-drawer anchor=\"bottom\">...</ytz-drawer>\n */\n\nimport { createFocusTrap } from './utils/focus-trap.js'\nimport { register } from './utils/register.js'\n\n/** @type {string} Selector for focusable elements */\nconst FOCUSABLE = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\n\n/** @type {string[]} Valid anchor positions */\nconst VALID_ANCHORS = ['left', 'right', 'top', 'bottom']\n\n/**\n * @class YtzDrawer\n * @extends HTMLElement\n */\nclass YtzDrawer extends HTMLElement {\n  static observedAttributes = ['open', 'anchor']\n\n  /** @type {HTMLElement|null} */\n  #previousFocus = null\n  /** @type {{ activate: () => void, deactivate: () => void }|null} */\n  #focusTrap = null\n  /** @type {string} */\n  #previousOverflow = ''\n\n  connectedCallback() {\n    this.setAttribute('role', 'dialog')\n    this.setAttribute('aria-modal', 'true')\n    this.hidden = !this.hasAttribute('open')\n\n    if (!this.hasAttribute('anchor')) {\n      this.setAttribute('anchor', 'left')\n    }\n\n    this.addEventListener('click', this.#handleBackdropClick)\n  }\n\n  disconnectedCallback() {\n    this.removeEventListener('click', this.#handleBackdropClick)\n    this.#cleanup()\n  }\n\n  attributeChangedCallback(name, oldVal, newVal) {\n    if (name === 'open' && this.isConnected) {\n      newVal !== null ? this.#open() : this.#close()\n    }\n    if (name === 'anchor' && newVal && !VALID_ANCHORS.includes(newVal)) {\n      this.setAttribute('anchor', 'left')\n    }\n  }\n\n  #open() {\n    this.#previousFocus = /** @type {HTMLElement} */ (document.activeElement)\n    this.hidden = false\n    this.#previousOverflow = document.body.style.overflow\n    document.body.style.overflow = 'hidden'\n    this.#focusTrap = createFocusTrap(this)\n    this.#focusTrap.activate()\n    document.addEventListener('keydown', this.#handleEscape)\n\n    requestAnimationFrame(() => {\n      const firstFocusable = this.querySelector(FOCUSABLE)\n      if (firstFocusable) {\n        /** @type {HTMLElement} */ (firstFocusable).focus()\n      } else {\n        this.setAttribute('tabindex', '-1')\n        this.focus()\n      }\n    })\n  }\n\n  #close() {\n    this.hidden = true\n    this.#cleanup()\n    this.dispatchEvent(new CustomEvent('close', { bubbles: true }))\n  }\n\n  #cleanup() {\n    document.body.style.overflow = this.#previousOverflow\n    this.#focusTrap?.deactivate()\n    this.#focusTrap = null\n    document.removeEventListener('keydown', this.#handleEscape)\n    this.#previousFocus?.focus()\n    this.#previousFocus = null\n  }\n\n  /** @param {KeyboardEvent} e */\n  #handleEscape = (e) => {\n    if (e.key === 'Escape' && this.hasAttribute('open')) {\n      e.preventDefault()\n      this.removeAttribute('open')\n    }\n  }\n\n  /** @param {MouseEvent} e */\n  #handleBackdropClick = (e) => {\n    if (e.target === this && !this.hasAttribute('static')) {\n      this.removeAttribute('open')\n    }\n  }\n\n  /** @type {boolean} */\n  get open() {\n    return this.hasAttribute('open')\n  }\n\n  set open(value) {\n    value ? this.setAttribute('open', '') : this.removeAttribute('open')\n  }\n\n  /** @type {'left'|'right'|'top'|'bottom'} */\n  get anchor() {\n    return /** @type {'left'|'right'|'top'|'bottom'} */ (this.getAttribute('anchor') || 'left')\n  }\n\n  set anchor(value) {\n    if (VALID_ANCHORS.includes(value)) this.setAttribute('anchor', value)\n  }\n\n  /** Close the drawer programmatically. */\n  close() {\n    this.removeAttribute('open')\n  }\n\n  /** Show the drawer programmatically. */\n  show() {\n    this.setAttribute('open', '')\n  }\n}\n\nregister('ytz-drawer', YtzDrawer)\n\nexport { YtzDrawer }\n"]}