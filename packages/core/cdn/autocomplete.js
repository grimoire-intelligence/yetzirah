function f(u,t,e={}){let{placement:s="top",offset:n=8}=e,i=u.getBoundingClientRect(),h=t.getBoundingClientRect(),d={width:window.innerWidth,height:window.innerHeight},r,o,l=s;switch(s){case "top":r=i.left+(i.width-h.width)/2,o=i.top-h.height-n;break;case "bottom":r=i.left+(i.width-h.width)/2,o=i.bottom+n;break;case "left":r=i.left-h.width-n,o=i.top+(i.height-h.height)/2;break;case "right":r=i.right+n,o=i.top+(i.height-h.height)/2;break}return s==="top"&&o<0?(o=i.bottom+n,l="bottom"):s==="bottom"&&o+h.height>d.height?(o=i.top-h.height-n,l="top"):s==="left"&&r<0?(r=i.right+n,l="right"):s==="right"&&r+h.width>d.width&&(r=i.left-h.width-n,l="left"),l==="top"||l==="bottom"?r=Math.max(0,Math.min(r,d.width-h.width)):o=Math.max(0,Math.min(o,d.height-h.height)),{x:r,y:o,placement:l}}function b(u,t={}){let{orientation:e="horizontal",wrap:s=true,autoActivate:n=true,onActivate:i}=t,h=e==="horizontal"?"ArrowLeft":"ArrowUp",d=e==="horizontal"?"ArrowRight":"ArrowDown";return {handleKeyDown(r){let o=u(),l=o.indexOf(document.activeElement);if(l===-1)return;let a=l;if(r.key===h)a=l-1,a<0&&(a=s?o.length-1:0);else if(r.key===d)a=l+1,a>=o.length&&(a=s?0:o.length-1);else if(r.key==="Home")a=0;else if(r.key==="End")a=o.length-1;else return;r.preventDefault(),o[a].focus(),n&&i&&i(o[a]);}}}function v(u,t,e={}){let{ignore:s}=e,n=i=>{u.contains(i.target)||s&&s.contains(i.target)||t(i);};return document.addEventListener("click",n,true),{destroy(){document.removeEventListener("click",n,true);}}}var m=0,c=class extends HTMLElement{static observedAttributes=["open","multiple","loading"];#t=null;#e=null;#r=null;#a=null;#o=null;#i=new Set;#h=false;connectedCallback(){this.#v();}disconnectedCallback(){this.#m();}attributeChangedCallback(t,e,s){this.isConnected&&(t==="open"&&(s!==null?this.#A():this.#y()),t==="loading"&&this.#b());}get open(){return this.hasAttribute("open")}set open(t){t?this.setAttribute("open",""):this.removeAttribute("open");}get multiple(){return this.hasAttribute("multiple")}set multiple(t){t?this.setAttribute("multiple",""):this.removeAttribute("multiple");}get loading(){return this.hasAttribute("loading")}set loading(t){t?this.setAttribute("loading",""):this.removeAttribute("loading");}get filter(){return this.getAttribute("filter")!=="false"}set filter(t){this.setAttribute("filter",t&&t!=="false"?"true":"false");}get value(){return this.multiple?[...this.#i]:[...this.#i][0]||""}set value(t){this.#i.clear(),Array.isArray(t)?t.forEach(e=>this.#i.add(e)):t&&this.#i.add(t),this.#s();}get inputValue(){return this.#t?.value||""}set inputValue(t){this.#t&&(this.#t.value=t);}#v(){if(this.#t=this.querySelector('[slot="input"]')||this.querySelector("input"),!this.#t)return;this.#r=`ytz-autocomplete-${++m}`,this.#e=document.createElement("div"),this.#e.setAttribute("role","listbox"),this.#e.id=this.#r,this.#e.hidden=true,this.multiple&&this.#e.setAttribute("aria-multiselectable","true"),[...this.querySelectorAll("ytz-option")].forEach(e=>this.#e.appendChild(e)),this.appendChild(this.#e),this.#t.setAttribute("role","combobox"),this.#t.setAttribute("aria-autocomplete","list"),this.#t.setAttribute("aria-controls",this.#r),this.#t.setAttribute("aria-expanded","false"),this.#t.setAttribute("aria-haspopup","listbox"),this.#a=b(()=>[...this.#e.querySelectorAll("ytz-option:not([hidden]):not([disabled])")],{orientation:"vertical",wrap:true,autoActivate:false}),this.#t.addEventListener("input",this.#u),this.#t.addEventListener("focus",this.#d),this.#t.addEventListener("keydown",this.#c),this.addEventListener("keydown",this.#p),this.addEventListener("option-click",this.#f),this.#e.querySelectorAll("ytz-option[selected]").forEach(e=>{let s=e.getAttribute("value")||e.textContent?.trim();s&&this.#i.add(s);}),this.#s(),this.#b();}#m(){this.#t?.removeEventListener("input",this.#u),this.#t?.removeEventListener("focus",this.#d),this.#t?.removeEventListener("keydown",this.#c),this.removeEventListener("keydown",this.#p),this.removeEventListener("option-click",this.#f),this.#o?.destroy();}#u=()=>{this.open||(this.open=true),this.filter&&this.#g(),this.dispatchEvent(new CustomEvent("input-change",{bubbles:true,detail:{value:this.#t.value}}));};#d=()=>{if(this.#h){this.#h=false;return}this.#e?.querySelector("ytz-option:not([hidden])")&&!this.loading&&(this.open=true);};#c=t=>{if(t.key==="ArrowDown")t.preventDefault(),t.stopPropagation(),this.open||(this.open=true),this.#e?.querySelector("ytz-option:not([hidden]):not([disabled])")?.focus();else if(t.key==="ArrowUp"){t.preventDefault(),t.stopPropagation(),this.open||(this.open=true);let e=this.#e?.querySelectorAll("ytz-option:not([hidden]):not([disabled])");e?.[e.length-1]?.focus();}else if(t.key==="Escape"&&this.open)t.preventDefault(),t.stopPropagation(),this.open=false;else if(t.key==="Enter"&&this.open){let e=this.#e?.querySelector("ytz-option:not([hidden]):not([disabled])");e&&(t.preventDefault(),this.#l(e));}};#p=t=>{if(this.open){if(t.key==="Escape"){t.preventDefault(),this.open=false,this.#t?.focus();return}if(document.activeElement?.tagName==="YTZ-OPTION"){if(this.#a?.handleKeyDown(t),t.key==="Enter"||t.key===" "){let e=this.#e?.querySelector("ytz-option:focus");e&&!e.hasAttribute("disabled")&&(t.preventDefault(),this.#l(e));}t.key==="Tab"&&(t.preventDefault(),this.#t?.focus());}}};#f=t=>{let e=t.detail?.option;e&&!e.hasAttribute("disabled")&&this.#l(e);};#l(t){let e=t.getAttribute("value")||t.textContent?.trim();e&&(this.multiple?this.#i.has(e)?this.#i.delete(e):this.#i.add(e):(this.#i.clear(),this.#i.add(e),this.#t.value=t.textContent?.trim()||e,this.#h=true,this.open=false,this.#t?.focus()),this.#s(),this.dispatchEvent(new CustomEvent("change",{bubbles:true,detail:{value:this.value,option:t}})));}#s(){(this.#e?.querySelectorAll("ytz-option")||[]).forEach(e=>{let s=e.getAttribute("value")||e.textContent?.trim(),n=this.#i.has(s);e.toggleAttribute("selected",n),e.setAttribute("aria-selected",String(n));});}#g(){let t=this.#t?.value.toLowerCase()||"";(this.#e?.querySelectorAll("ytz-option")||[]).forEach(s=>{let n=s.textContent?.toLowerCase()||"";s.hidden=!n.includes(t);});}#A(){!this.#t||!this.#e||(this.#e.hidden=false,this.#t.setAttribute("aria-expanded","true"),this.#n(),this.#o=v(this,()=>{this.open=false;}),window.addEventListener("scroll",this.#n,{passive:true,capture:true}),window.addEventListener("resize",this.#n,{passive:true}),this.dispatchEvent(new CustomEvent("open",{bubbles:true})));}#y(){!this.#t||!this.#e||(this.#e.hidden=true,this.#t.setAttribute("aria-expanded","false"),this.#o?.destroy(),this.#o=null,window.removeEventListener("scroll",this.#n,{capture:true}),window.removeEventListener("resize",this.#n),this.dispatchEvent(new CustomEvent("close",{bubbles:true})));}#n=()=>{if(!this.#t||!this.#e)return;let{x:t,y:e}=f(this.#t,this.#e,{placement:"bottom",offset:4});this.#e.style.position="fixed",this.#e.style.left=`${t}px`,this.#e.style.top=`${e}px`,this.#e.style.minWidth=`${this.#t.offsetWidth}px`;};#b(){let t=this.querySelector('[slot="loading"]');t&&(t.hidden=!this.loading);}show(){this.open=true;}hide(){this.open=false;}toggle(){this.open=!this.open;}clear(){this.#i.clear(),this.#s(),this.#t&&(this.#t.value=""),this.dispatchEvent(new CustomEvent("clear",{bubbles:true}));}setOptions(t){this.#e&&(this.#e.innerHTML="",t.forEach(({value:e,label:s,disabled:n})=>{let i=document.createElement("ytz-option");i.setAttribute("value",e),i.textContent=s,n&&i.setAttribute("disabled",""),this.#e.appendChild(i);}),this.#s());}},p=class extends HTMLElement{connectedCallback(){this.setAttribute("role","option"),!this.hasAttribute("tabindex")&&!this.hasAttribute("disabled")&&this.setAttribute("tabindex","-1"),this.hasAttribute("disabled")&&this.setAttribute("aria-disabled","true"),this.setAttribute("aria-selected",this.hasAttribute("selected")?"true":"false"),this.addEventListener("click",this.#t);}disconnectedCallback(){this.removeEventListener("click",this.#t);}#t=t=>{if(this.hasAttribute("disabled")){t.preventDefault(),t.stopPropagation();return}this.dispatchEvent(new CustomEvent("option-click",{bubbles:true,detail:{option:this}}));};get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?(this.setAttribute("disabled",""),this.setAttribute("aria-disabled","true"),this.removeAttribute("tabindex")):(this.removeAttribute("disabled"),this.removeAttribute("aria-disabled"),this.setAttribute("tabindex","-1"));}get selected(){return this.hasAttribute("selected")}set selected(t){t?this.setAttribute("selected",""):this.removeAttribute("selected"),this.setAttribute("aria-selected",String(t));}get value(){return this.getAttribute("value")}set value(t){t?this.setAttribute("value",t):this.removeAttribute("value");}};customElements.define("ytz-autocomplete",c);customElements.define("ytz-option",p);export{c as YtzAutocomplete,p as YtzOption};//# sourceMappingURL=autocomplete.js.map
//# sourceMappingURL=autocomplete.js.map