{"version":3,"sources":["../src/utils/key-nav.js","../src/utils/register.js","../src/listbox.js"],"names":["createKeyNav","getItems","options","orientation","wrap","autoActivate","onActivate","prevKey","nextKey","e","items","currentIndex","newIndex","register","name","constructor","listboxId","YtzListbox","#keyNav","#selected","#id","#setup","#cleanup","oldVal","newVal","#updateDisabledState","v","val","#updateSelectedState","#handleKeyDown","#handleOptionClick","#handleFocus","opt","value","selected","first","focused","#selectOption","option","isSelected"],"mappings":"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","file":"listbox.js","sourcesContent":["/**\r\n * Keyboard navigation utility for arrow key navigation.\r\n * @module @grimoire/yetzirah-core/utils/key-nav\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Creates keyboard navigation for a set of elements.\r\n * @param {() => HTMLElement[]} getItems - Function returning navigable elements\r\n * @param {Object} options\r\n * @param {'horizontal'|'vertical'} [options.orientation='horizontal']\r\n * @param {boolean} [options.wrap=true]\r\n * @param {boolean} [options.autoActivate=true]\r\n * @param {(item: HTMLElement) => void} [options.onActivate]\r\n * @returns {{ handleKeyDown: (e: KeyboardEvent) => void }}\r\n */\r\nexport function createKeyNav(getItems, options = {}) {\r\n  const { orientation = 'horizontal', wrap = true, autoActivate = true, onActivate } = options\r\n  const prevKey = orientation === 'horizontal' ? 'ArrowLeft' : 'ArrowUp'\r\n  const nextKey = orientation === 'horizontal' ? 'ArrowRight' : 'ArrowDown'\r\n\r\n  return {\r\n    handleKeyDown(e) {\r\n      const items = getItems()\r\n      const currentIndex = items.indexOf(document.activeElement)\r\n      if (currentIndex === -1) return\r\n\r\n      let newIndex = currentIndex\r\n      if (e.key === prevKey) {\r\n        newIndex = currentIndex - 1\r\n        if (newIndex < 0) newIndex = wrap ? items.length - 1 : 0\r\n      } else if (e.key === nextKey) {\r\n        newIndex = currentIndex + 1\r\n        if (newIndex >= items.length) newIndex = wrap ? 0 : items.length - 1\r\n      } else if (e.key === 'Home') {\r\n        newIndex = 0\r\n      } else if (e.key === 'End') {\r\n        newIndex = items.length - 1\r\n      } else {\r\n        return\r\n      }\r\n\r\n      e.preventDefault()\r\n      items[newIndex].focus()\r\n      if (autoActivate && onActivate) onActivate(items[newIndex])\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Idempotent custom element registration utility.\r\n * Prevents duplicate registration errors when scripts load multiple times.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/register\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Register a custom element if not already registered.\r\n * Safe to call multiple times with the same name.\r\n *\r\n * @param {string} name - Custom element tag name (e.g., 'ytz-button')\r\n * @param {CustomElementConstructor} constructor - The element class\r\n */\r\nexport function register(name, constructor) {\r\n  if (!customElements.get(name)) {\r\n    customElements.define(name, constructor)\r\n  }\r\n}\r\n","/**\r\n * ytz-listbox - Keyboard-navigable list selection with single/multi-select modes.\r\n * @module @grimoire/yetzirah-core/listbox\r\n */\r\n\r\nimport { createKeyNav } from './utils/key-nav.js'\r\nimport { register } from './utils/register.js'\r\n\r\nlet listboxId = 0\r\n\r\nclass YtzListbox extends HTMLElement {\r\n  static observedAttributes = ['multiple', 'disabled']\r\n  #keyNav = null\r\n  #selected = new Set()\r\n  #id = null\r\n\r\n  connectedCallback() { this.#setup() }\r\n  disconnectedCallback() { this.#cleanup() }\r\n\r\n  attributeChangedCallback(name, oldVal, newVal) {\r\n    if (!this.isConnected) return\r\n    if (name === 'multiple') this.setAttribute('aria-multiselectable', newVal !== null ? 'true' : 'false')\r\n    if (name === 'disabled') this.#updateDisabledState()\r\n  }\r\n\r\n  get multiple() { return this.hasAttribute('multiple') }\r\n  set multiple(v) { v ? this.setAttribute('multiple', '') : this.removeAttribute('multiple') }\r\n\r\n  get disabled() { return this.hasAttribute('disabled') }\r\n  set disabled(v) { v ? this.setAttribute('disabled', '') : this.removeAttribute('disabled') }\r\n\r\n  get value() {\r\n    return this.multiple ? [...this.#selected] : ([...this.#selected][0] || '')\r\n  }\r\n  set value(v) {\r\n    this.#selected.clear()\r\n    if (Array.isArray(v)) v.forEach(val => this.#selected.add(val))\r\n    else if (v) this.#selected.add(v)\r\n    this.#updateSelectedState()\r\n  }\r\n\r\n  get options() { return [...this.querySelectorAll('ytz-option')] }\r\n  get selectedOptions() { return [...this.querySelectorAll('ytz-option[selected]')] }\r\n\r\n  #setup() {\r\n    this.#id = `ytz-listbox-${++listboxId}`\r\n    if (!this.id) this.id = this.#id\r\n    this.setAttribute('role', 'listbox')\r\n    if (this.multiple) this.setAttribute('aria-multiselectable', 'true')\r\n    if (!this.hasAttribute('tabindex')) this.setAttribute('tabindex', '0')\r\n\r\n    this.#keyNav = createKeyNav(\r\n      () => [...this.querySelectorAll('ytz-option:not([disabled])')],\r\n      { orientation: 'vertical', wrap: true, autoActivate: false }\r\n    )\r\n\r\n    this.addEventListener('keydown', this.#handleKeyDown)\r\n    this.addEventListener('option-click', this.#handleOptionClick)\r\n    this.addEventListener('focus', this.#handleFocus)\r\n\r\n    this.querySelectorAll('ytz-option[selected]').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      if (value) this.#selected.add(value)\r\n    })\r\n    this.#updateSelectedState()\r\n  }\r\n\r\n  #cleanup() {\r\n    this.removeEventListener('keydown', this.#handleKeyDown)\r\n    this.removeEventListener('option-click', this.#handleOptionClick)\r\n    this.removeEventListener('focus', this.#handleFocus)\r\n  }\r\n\r\n  #handleFocus = () => {\r\n    const selected = this.querySelector('ytz-option[selected]:not([disabled])')\r\n    const first = this.querySelector('ytz-option:not([disabled])')\r\n    ;(selected || first)?.focus()\r\n  }\r\n\r\n  #handleKeyDown = (e) => {\r\n    if (this.disabled) return\r\n    this.#keyNav?.handleKeyDown(e)\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      const focused = this.querySelector('ytz-option:focus')\r\n      if (focused && !focused.hasAttribute('disabled')) {\r\n        e.preventDefault()\r\n        this.#selectOption(focused)\r\n      }\r\n    }\r\n  }\r\n\r\n  #handleOptionClick = (e) => {\r\n    if (this.disabled) return\r\n    const option = e.detail?.option\r\n    if (option && !option.hasAttribute('disabled')) this.#selectOption(option)\r\n  }\r\n\r\n  #selectOption(option) {\r\n    const value = option.getAttribute('value') || option.textContent?.trim()\r\n    if (!value) return\r\n\r\n    if (this.multiple) {\r\n      this.#selected.has(value) ? this.#selected.delete(value) : this.#selected.add(value)\r\n    } else {\r\n      this.#selected.clear()\r\n      this.#selected.add(value)\r\n    }\r\n    this.#updateSelectedState()\r\n    this.dispatchEvent(new CustomEvent('change', { bubbles: true, detail: { value: this.value, option } }))\r\n  }\r\n\r\n  #updateSelectedState() {\r\n    this.querySelectorAll('ytz-option').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      const isSelected = this.#selected.has(value)\r\n      opt.toggleAttribute('selected', isSelected)\r\n      opt.setAttribute('aria-selected', String(isSelected))\r\n    })\r\n  }\r\n\r\n  #updateDisabledState() {\r\n    if (this.disabled) {\r\n      this.setAttribute('aria-disabled', 'true')\r\n      this.removeAttribute('tabindex')\r\n    } else {\r\n      this.removeAttribute('aria-disabled')\r\n      this.setAttribute('tabindex', '0')\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.#selected.clear()\r\n    this.#updateSelectedState()\r\n    this.dispatchEvent(new CustomEvent('clear', { bubbles: true }))\r\n  }\r\n\r\n  selectAll() {\r\n    if (!this.multiple) return\r\n    this.querySelectorAll('ytz-option:not([disabled])').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      if (value) this.#selected.add(value)\r\n    })\r\n    this.#updateSelectedState()\r\n  }\r\n}\r\n\r\nregister('ytz-listbox', YtzListbox)\r\n\r\nexport { YtzListbox }\r\n"]}