{"version":3,"sources":["../src/utils/key-nav.js","../src/listbox.js"],"names":["createKeyNav","getItems","options","orientation","wrap","autoActivate","onActivate","prevKey","nextKey","e","items","currentIndex","newIndex","listboxId","YtzListbox","#keyNav","#selected","#id","#setup","#cleanup","name","oldVal","newVal","#updateDisabledState","v","val","#updateSelectedState","#handleKeyDown","#handleOptionClick","#handleFocus","opt","value","selected","first","focused","#selectOption","option","isSelected"],"mappings":"AAgBO,SAASA,EAAaC,CAAAA,CAAUC,CAAAA,CAAU,EAAC,CAAG,CACnD,GAAM,CAAE,WAAA,CAAAC,CAAAA,CAAc,aAAc,IAAA,CAAAC,CAAAA,CAAO,KAAM,YAAA,CAAAC,CAAAA,CAAe,KAAM,UAAA,CAAAC,CAAW,CAAA,CAAIJ,CAAAA,CAC/EK,EAAUJ,CAAAA,GAAgB,YAAA,CAAe,WAAA,CAAc,SAAA,CACvDK,EAAUL,CAAAA,GAAgB,YAAA,CAAe,YAAA,CAAe,WAAA,CAE9D,OAAO,CACL,aAAA,CAAcM,EAAG,CACf,IAAMC,EAAQT,CAAAA,EAAS,CACjBU,CAAAA,CAAeD,CAAAA,CAAM,QAAQ,QAAA,CAAS,aAAa,CAAA,CACzD,GAAIC,IAAiB,EAAA,CAAI,OAEzB,IAAIC,CAAAA,CAAWD,EACf,GAAIF,CAAAA,CAAE,MAAQF,CAAAA,CACZK,CAAAA,CAAWD,EAAe,CAAA,CACtBC,CAAAA,CAAW,CAAA,GAAGA,CAAAA,CAAWR,EAAOM,CAAAA,CAAM,MAAA,CAAS,EAAI,CAAA,CAAA,CAAA,KAAA,GAC9CD,CAAAA,CAAE,MAAQD,CAAAA,CACnBI,CAAAA,CAAWD,CAAAA,CAAe,CAAA,CACtBC,GAAYF,CAAAA,CAAM,MAAA,GAAQE,EAAWR,CAAAA,CAAO,CAAA,CAAIM,EAAM,MAAA,CAAS,CAAA,CAAA,CAAA,KAAA,GAC1DD,CAAAA,CAAE,GAAA,GAAQ,OACnBG,CAAAA,CAAW,CAAA,CAAA,KAAA,GACFH,CAAAA,CAAE,GAAA,GAAQ,MACnBG,CAAAA,CAAWF,CAAAA,CAAM,MAAA,CAAS,CAAA,CAAA,YAK5BD,CAAAA,CAAE,cAAA,GACFC,CAAAA,CAAME,CAAQ,EAAE,KAAA,EAAM,CAClBP,CAAAA,EAAgBC,CAAAA,EAAYA,EAAWI,CAAAA,CAAME,CAAQ,CAAC,EAC5D,CACF,CACF,CCxCA,IAAIC,CAAAA,CAAY,CAAA,CAEVC,EAAN,cAAyB,WAAY,CACnC,OAAO,kBAAA,CAAqB,CAAC,UAAA,CAAY,UAAU,CAAA,CACnDC,EAAAA,CAAU,KACVC,EAAAA,CAAY,IAAI,GAAA,CAChBC,EAAAA,CAAM,KAEN,iBAAA,EAAoB,CAAE,IAAA,CAAKC,EAAAA,GAAS,CACpC,oBAAA,EAAuB,CAAE,IAAA,CAAKC,EAAAA,GAAW,CAEzC,wBAAA,CAAyBC,CAAAA,CAAMC,CAAAA,CAAQC,EAAQ,CACxC,IAAA,CAAK,cACNF,CAAAA,GAAS,UAAA,EAAY,KAAK,YAAA,CAAa,sBAAA,CAAwBE,CAAAA,GAAW,IAAA,CAAO,OAAS,OAAO,CAAA,CACjGF,IAAS,UAAA,EAAY,IAAA,CAAKG,IAAqB,EACrD,CAEA,IAAI,QAAA,EAAW,CAAE,OAAO,IAAA,CAAK,YAAA,CAAa,UAAU,CAAE,CACtD,IAAI,QAAA,CAASC,CAAAA,CAAG,CAAEA,CAAAA,CAAI,IAAA,CAAK,aAAa,UAAA,CAAY,EAAE,EAAI,IAAA,CAAK,eAAA,CAAgB,UAAU,EAAE,CAE3F,IAAI,QAAA,EAAW,CAAE,OAAO,KAAK,YAAA,CAAa,UAAU,CAAE,CACtD,IAAI,QAAA,CAASA,CAAAA,CAAG,CAAEA,CAAAA,CAAI,IAAA,CAAK,aAAa,UAAA,CAAY,EAAE,CAAA,CAAI,IAAA,CAAK,gBAAgB,UAAU,EAAE,CAE3F,IAAI,OAAQ,CACV,OAAO,IAAA,CAAK,QAAA,CAAW,CAAC,GAAG,IAAA,CAAKR,EAAS,CAAA,CAAK,CAAC,GAAG,IAAA,CAAKA,EAAS,CAAA,CAAE,CAAC,GAAK,EAC1E,CACA,IAAI,KAAA,CAAMQ,CAAAA,CAAG,CACX,IAAA,CAAKR,EAAAA,CAAU,KAAA,EAAM,CACjB,MAAM,OAAA,CAAQQ,CAAC,EAAGA,CAAAA,CAAE,OAAA,CAAQC,GAAO,IAAA,CAAKT,EAAAA,CAAU,GAAA,CAAIS,CAAG,CAAC,CAAA,CACrDD,CAAAA,EAAG,IAAA,CAAKR,EAAAA,CAAU,IAAIQ,CAAC,CAAA,CAChC,IAAA,CAAKE,EAAAA,GACP,CAEA,IAAI,SAAU,CAAE,OAAO,CAAC,GAAG,IAAA,CAAK,gBAAA,CAAiB,YAAY,CAAC,CAAE,CAChE,IAAI,eAAA,EAAkB,CAAE,OAAO,CAAC,GAAG,IAAA,CAAK,gBAAA,CAAiB,sBAAsB,CAAC,CAAE,CAElFR,EAAAA,EAAS,CACP,KAAKD,EAAAA,CAAM,CAAA,YAAA,EAAe,EAAEJ,CAAS,GAChC,IAAA,CAAK,EAAA,GAAI,IAAA,CAAK,EAAA,CAAK,KAAKI,EAAAA,CAAAA,CAC7B,IAAA,CAAK,YAAA,CAAa,MAAA,CAAQ,SAAS,CAAA,CAC/B,IAAA,CAAK,UAAU,IAAA,CAAK,YAAA,CAAa,uBAAwB,MAAM,CAAA,CAC9D,IAAA,CAAK,YAAA,CAAa,UAAU,CAAA,EAAG,IAAA,CAAK,aAAa,UAAA,CAAY,GAAG,EAErE,IAAA,CAAKF,EAAAA,CAAUf,CAAAA,CACb,IAAM,CAAC,GAAG,IAAA,CAAK,iBAAiB,4BAA4B,CAAC,EAC7D,CAAE,WAAA,CAAa,UAAA,CAAY,IAAA,CAAM,KAAM,YAAA,CAAc,KAAM,CAC7D,CAAA,CAEA,KAAK,gBAAA,CAAiB,SAAA,CAAW,IAAA,CAAK2B,EAAc,EACpD,IAAA,CAAK,gBAAA,CAAiB,eAAgB,IAAA,CAAKC,EAAkB,EAC7D,IAAA,CAAK,gBAAA,CAAiB,OAAA,CAAS,IAAA,CAAKC,EAAY,CAAA,CAEhD,IAAA,CAAK,gBAAA,CAAiB,sBAAsB,EAAE,OAAA,CAAQC,CAAAA,EAAO,CAC3D,IAAMC,EAAQD,CAAAA,CAAI,YAAA,CAAa,OAAO,CAAA,EAAKA,CAAAA,CAAI,aAAa,IAAA,EAAK,CAC7DC,CAAAA,EAAO,IAAA,CAAKf,GAAU,GAAA,CAAIe,CAAK,EACrC,CAAC,EACD,IAAA,CAAKL,EAAAA,GACP,CAEAP,IAAW,CACT,IAAA,CAAK,oBAAoB,SAAA,CAAW,IAAA,CAAKQ,EAAc,CAAA,CACvD,IAAA,CAAK,mBAAA,CAAoB,cAAA,CAAgB,KAAKC,EAAkB,CAAA,CAChE,KAAK,mBAAA,CAAoB,OAAA,CAAS,KAAKC,EAAY,EACrD,CAEAA,EAAAA,CAAe,IAAM,CACnB,IAAMG,EAAW,IAAA,CAAK,aAAA,CAAc,sCAAsC,CAAA,CACpEC,CAAAA,CAAQ,IAAA,CAAK,aAAA,CAAc,4BAA4B,CAAA,CAAA,CAC3DD,CAAAA,EAAYC,CAAAA,GAAQ,KAAA,GACxB,CAAA,CAEAN,EAAAA,CAAkBlB,CAAAA,EAAM,CACtB,GAAI,CAAA,IAAA,CAAK,QAAA,GACT,KAAKM,EAAAA,EAAS,aAAA,CAAcN,CAAC,CAAA,CACzBA,CAAAA,CAAE,GAAA,GAAQ,OAAA,EAAWA,EAAE,GAAA,GAAQ,GAAA,CAAA,CAAK,CACtC,IAAMyB,CAAAA,CAAU,KAAK,aAAA,CAAc,kBAAkB,CAAA,CACjDA,CAAAA,EAAW,CAACA,CAAAA,CAAQ,YAAA,CAAa,UAAU,CAAA,GAC7CzB,CAAAA,CAAE,gBAAe,CACjB,IAAA,CAAK0B,EAAAA,CAAcD,CAAO,GAE9B,CACF,CAAA,CAEAN,EAAAA,CAAsBnB,CAAAA,EAAM,CAC1B,GAAI,IAAA,CAAK,QAAA,CAAU,OACnB,IAAM2B,CAAAA,CAAS3B,CAAAA,CAAE,QAAQ,MAAA,CACrB2B,CAAAA,EAAU,CAACA,CAAAA,CAAO,YAAA,CAAa,UAAU,CAAA,EAAG,KAAKD,EAAAA,CAAcC,CAAM,EAC3E,CAAA,CAEAD,EAAAA,CAAcC,EAAQ,CACpB,IAAML,CAAAA,CAAQK,CAAAA,CAAO,aAAa,OAAO,CAAA,EAAKA,EAAO,WAAA,EAAa,IAAA,GAC7DL,CAAAA,GAED,IAAA,CAAK,QAAA,CACP,IAAA,CAAKf,GAAU,GAAA,CAAIe,CAAK,CAAA,CAAI,IAAA,CAAKf,GAAU,MAAA,CAAOe,CAAK,CAAA,CAAI,IAAA,CAAKf,GAAU,GAAA,CAAIe,CAAK,GAEnF,IAAA,CAAKf,EAAAA,CAAU,OAAM,CACrB,IAAA,CAAKA,EAAAA,CAAU,GAAA,CAAIe,CAAK,CAAA,CAAA,CAE1B,IAAA,CAAKL,EAAAA,EAAqB,CAC1B,KAAK,aAAA,CAAc,IAAI,WAAA,CAAY,QAAA,CAAU,CAAE,OAAA,CAAS,IAAA,CAAM,OAAQ,CAAE,KAAA,CAAO,KAAK,KAAA,CAAO,MAAA,CAAAU,CAAO,CAAE,CAAC,CAAC,CAAA,EACxG,CAEAV,EAAAA,EAAuB,CACrB,IAAA,CAAK,gBAAA,CAAiB,YAAY,CAAA,CAAE,QAAQI,CAAAA,EAAO,CACjD,IAAMC,CAAAA,CAAQD,CAAAA,CAAI,aAAa,OAAO,CAAA,EAAKA,CAAAA,CAAI,WAAA,EAAa,MAAK,CAC3DO,CAAAA,CAAa,KAAKrB,EAAAA,CAAU,GAAA,CAAIe,CAAK,CAAA,CAC3CD,CAAAA,CAAI,eAAA,CAAgB,UAAA,CAAYO,CAAU,CAAA,CAC1CP,CAAAA,CAAI,aAAa,eAAA,CAAiB,MAAA,CAAOO,CAAU,CAAC,EACtD,CAAC,EACH,CAEAd,EAAAA,EAAuB,CACjB,IAAA,CAAK,QAAA,EACP,KAAK,YAAA,CAAa,eAAA,CAAiB,MAAM,CAAA,CACzC,KAAK,eAAA,CAAgB,UAAU,IAE/B,IAAA,CAAK,eAAA,CAAgB,eAAe,CAAA,CACpC,IAAA,CAAK,YAAA,CAAa,UAAA,CAAY,GAAG,CAAA,EAErC,CAEA,OAAQ,CACN,IAAA,CAAKP,GAAU,KAAA,EAAM,CACrB,IAAA,CAAKU,EAAAA,GACL,IAAA,CAAK,aAAA,CAAc,IAAI,WAAA,CAAY,OAAA,CAAS,CAAE,OAAA,CAAS,IAAK,CAAC,CAAC,EAChE,CAEA,SAAA,EAAY,CACL,IAAA,CAAK,WACV,IAAA,CAAK,gBAAA,CAAiB,4BAA4B,CAAA,CAAE,QAAQI,CAAAA,EAAO,CACjE,IAAMC,CAAAA,CAAQD,CAAAA,CAAI,aAAa,OAAO,CAAA,EAAKA,CAAAA,CAAI,WAAA,EAAa,MAAK,CAC7DC,CAAAA,EAAO,KAAKf,EAAAA,CAAU,GAAA,CAAIe,CAAK,EACrC,CAAC,CAAA,CACD,IAAA,CAAKL,IAAqB,EAC5B,CACF,EAEA,cAAA,CAAe,MAAA,CAAO,cAAeZ,CAAU,CAAA","file":"listbox.js","sourcesContent":["/**\r\n * Keyboard navigation utility for arrow key navigation.\r\n * @module @grimoire/yetzirah-core/utils/key-nav\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Creates keyboard navigation for a set of elements.\r\n * @param {() => HTMLElement[]} getItems - Function returning navigable elements\r\n * @param {Object} options\r\n * @param {'horizontal'|'vertical'} [options.orientation='horizontal']\r\n * @param {boolean} [options.wrap=true]\r\n * @param {boolean} [options.autoActivate=true]\r\n * @param {(item: HTMLElement) => void} [options.onActivate]\r\n * @returns {{ handleKeyDown: (e: KeyboardEvent) => void }}\r\n */\r\nexport function createKeyNav(getItems, options = {}) {\r\n  const { orientation = 'horizontal', wrap = true, autoActivate = true, onActivate } = options\r\n  const prevKey = orientation === 'horizontal' ? 'ArrowLeft' : 'ArrowUp'\r\n  const nextKey = orientation === 'horizontal' ? 'ArrowRight' : 'ArrowDown'\r\n\r\n  return {\r\n    handleKeyDown(e) {\r\n      const items = getItems()\r\n      const currentIndex = items.indexOf(document.activeElement)\r\n      if (currentIndex === -1) return\r\n\r\n      let newIndex = currentIndex\r\n      if (e.key === prevKey) {\r\n        newIndex = currentIndex - 1\r\n        if (newIndex < 0) newIndex = wrap ? items.length - 1 : 0\r\n      } else if (e.key === nextKey) {\r\n        newIndex = currentIndex + 1\r\n        if (newIndex >= items.length) newIndex = wrap ? 0 : items.length - 1\r\n      } else if (e.key === 'Home') {\r\n        newIndex = 0\r\n      } else if (e.key === 'End') {\r\n        newIndex = items.length - 1\r\n      } else {\r\n        return\r\n      }\r\n\r\n      e.preventDefault()\r\n      items[newIndex].focus()\r\n      if (autoActivate && onActivate) onActivate(items[newIndex])\r\n    }\r\n  }\r\n}\r\n","/**\r\n * ytz-listbox - Keyboard-navigable list selection with single/multi-select modes.\r\n * @module @grimoire/yetzirah-core/listbox\r\n */\r\n\r\nimport { createKeyNav } from './utils/key-nav.js'\r\n\r\nlet listboxId = 0\r\n\r\nclass YtzListbox extends HTMLElement {\r\n  static observedAttributes = ['multiple', 'disabled']\r\n  #keyNav = null\r\n  #selected = new Set()\r\n  #id = null\r\n\r\n  connectedCallback() { this.#setup() }\r\n  disconnectedCallback() { this.#cleanup() }\r\n\r\n  attributeChangedCallback(name, oldVal, newVal) {\r\n    if (!this.isConnected) return\r\n    if (name === 'multiple') this.setAttribute('aria-multiselectable', newVal !== null ? 'true' : 'false')\r\n    if (name === 'disabled') this.#updateDisabledState()\r\n  }\r\n\r\n  get multiple() { return this.hasAttribute('multiple') }\r\n  set multiple(v) { v ? this.setAttribute('multiple', '') : this.removeAttribute('multiple') }\r\n\r\n  get disabled() { return this.hasAttribute('disabled') }\r\n  set disabled(v) { v ? this.setAttribute('disabled', '') : this.removeAttribute('disabled') }\r\n\r\n  get value() {\r\n    return this.multiple ? [...this.#selected] : ([...this.#selected][0] || '')\r\n  }\r\n  set value(v) {\r\n    this.#selected.clear()\r\n    if (Array.isArray(v)) v.forEach(val => this.#selected.add(val))\r\n    else if (v) this.#selected.add(v)\r\n    this.#updateSelectedState()\r\n  }\r\n\r\n  get options() { return [...this.querySelectorAll('ytz-option')] }\r\n  get selectedOptions() { return [...this.querySelectorAll('ytz-option[selected]')] }\r\n\r\n  #setup() {\r\n    this.#id = `ytz-listbox-${++listboxId}`\r\n    if (!this.id) this.id = this.#id\r\n    this.setAttribute('role', 'listbox')\r\n    if (this.multiple) this.setAttribute('aria-multiselectable', 'true')\r\n    if (!this.hasAttribute('tabindex')) this.setAttribute('tabindex', '0')\r\n\r\n    this.#keyNav = createKeyNav(\r\n      () => [...this.querySelectorAll('ytz-option:not([disabled])')],\r\n      { orientation: 'vertical', wrap: true, autoActivate: false }\r\n    )\r\n\r\n    this.addEventListener('keydown', this.#handleKeyDown)\r\n    this.addEventListener('option-click', this.#handleOptionClick)\r\n    this.addEventListener('focus', this.#handleFocus)\r\n\r\n    this.querySelectorAll('ytz-option[selected]').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      if (value) this.#selected.add(value)\r\n    })\r\n    this.#updateSelectedState()\r\n  }\r\n\r\n  #cleanup() {\r\n    this.removeEventListener('keydown', this.#handleKeyDown)\r\n    this.removeEventListener('option-click', this.#handleOptionClick)\r\n    this.removeEventListener('focus', this.#handleFocus)\r\n  }\r\n\r\n  #handleFocus = () => {\r\n    const selected = this.querySelector('ytz-option[selected]:not([disabled])')\r\n    const first = this.querySelector('ytz-option:not([disabled])')\r\n    ;(selected || first)?.focus()\r\n  }\r\n\r\n  #handleKeyDown = (e) => {\r\n    if (this.disabled) return\r\n    this.#keyNav?.handleKeyDown(e)\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      const focused = this.querySelector('ytz-option:focus')\r\n      if (focused && !focused.hasAttribute('disabled')) {\r\n        e.preventDefault()\r\n        this.#selectOption(focused)\r\n      }\r\n    }\r\n  }\r\n\r\n  #handleOptionClick = (e) => {\r\n    if (this.disabled) return\r\n    const option = e.detail?.option\r\n    if (option && !option.hasAttribute('disabled')) this.#selectOption(option)\r\n  }\r\n\r\n  #selectOption(option) {\r\n    const value = option.getAttribute('value') || option.textContent?.trim()\r\n    if (!value) return\r\n\r\n    if (this.multiple) {\r\n      this.#selected.has(value) ? this.#selected.delete(value) : this.#selected.add(value)\r\n    } else {\r\n      this.#selected.clear()\r\n      this.#selected.add(value)\r\n    }\r\n    this.#updateSelectedState()\r\n    this.dispatchEvent(new CustomEvent('change', { bubbles: true, detail: { value: this.value, option } }))\r\n  }\r\n\r\n  #updateSelectedState() {\r\n    this.querySelectorAll('ytz-option').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      const isSelected = this.#selected.has(value)\r\n      opt.toggleAttribute('selected', isSelected)\r\n      opt.setAttribute('aria-selected', String(isSelected))\r\n    })\r\n  }\r\n\r\n  #updateDisabledState() {\r\n    if (this.disabled) {\r\n      this.setAttribute('aria-disabled', 'true')\r\n      this.removeAttribute('tabindex')\r\n    } else {\r\n      this.removeAttribute('aria-disabled')\r\n      this.setAttribute('tabindex', '0')\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.#selected.clear()\r\n    this.#updateSelectedState()\r\n    this.dispatchEvent(new CustomEvent('clear', { bubbles: true }))\r\n  }\r\n\r\n  selectAll() {\r\n    if (!this.multiple) return\r\n    this.querySelectorAll('ytz-option:not([disabled])').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      if (value) this.#selected.add(value)\r\n    })\r\n    this.#updateSelectedState()\r\n  }\r\n}\r\n\r\ncustomElements.define('ytz-listbox', YtzListbox)\r\n\r\nexport { YtzListbox }\r\n"]}