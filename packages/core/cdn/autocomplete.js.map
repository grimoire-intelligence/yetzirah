{"version":3,"sources":["../src/utils/position.js","../src/utils/key-nav.js","../src/utils/click-outside.js","../src/utils/register.js","../src/autocomplete.js"],"names":["position","anchor","floating","options","placement","offset","anchorRect","floatingRect","viewport","x","y","finalPlacement","createKeyNav","getItems","orientation","wrap","autoActivate","onActivate","prevKey","nextKey","e","items","currentIndex","newIndex","clickOutside","element","callback","ignore","handleClick","register","name","constructor","autocompleteId","YtzAutocomplete","#input","#listbox","#listboxId","#keyNav","#clickOutsideHandler","#selected","#justClosed","#setup","#cleanup","oldVal","newVal","#showListbox","#hideListbox","#updateLoadingState","v","val","#updateSelectedState","opt","#handleInput","#handleInputFocus","#handleInputKeyDown","#handleKeyDown","#handleOptionClick","value","#filterOptions","firstOption","#selectOption","focused","option","isSelected","query","text","#updatePosition","loadingSlot","label","disabled","YtzOption","#handleClick"],"mappings":"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","file":"autocomplete.js","sourcesContent":["/**\r\n * Position utility for tooltips, menus, popovers.\r\n * Places an element relative to an anchor with flip/shift logic.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/position\r\n * @internal Not exported from package\r\n *\r\n * Limitations (by design):\r\n * - Does not handle nested scroll containers\r\n * - Does not support virtual elements\r\n * - No middleware system\r\n */\r\n\r\n/**\r\n * Position a floating element relative to an anchor.\r\n *\r\n * @param {HTMLElement} anchor - Element to position relative to\r\n * @param {HTMLElement} floating - Element to position\r\n * @param {Object} [options] - Positioning options\r\n * @param {'top'|'bottom'|'left'|'right'} [options.placement='top'] - Preferred placement\r\n * @param {number} [options.offset=8] - Gap between anchor and floating element\r\n * @returns {{ x: number, y: number, placement: string }}\r\n */\r\nexport function position(anchor, floating, options = {}) {\r\n  const { placement = 'top', offset = 8 } = options\r\n\r\n  const anchorRect = anchor.getBoundingClientRect()\r\n  const floatingRect = floating.getBoundingClientRect()\r\n  const viewport = { width: window.innerWidth, height: window.innerHeight }\r\n\r\n  let x, y\r\n  let finalPlacement = placement\r\n\r\n  // Calculate position based on placement\r\n  switch (placement) {\r\n    case 'top':\r\n      x = anchorRect.left + (anchorRect.width - floatingRect.width) / 2\r\n      y = anchorRect.top - floatingRect.height - offset\r\n      break\r\n    case 'bottom':\r\n      x = anchorRect.left + (anchorRect.width - floatingRect.width) / 2\r\n      y = anchorRect.bottom + offset\r\n      break\r\n    case 'left':\r\n      x = anchorRect.left - floatingRect.width - offset\r\n      y = anchorRect.top + (anchorRect.height - floatingRect.height) / 2\r\n      break\r\n    case 'right':\r\n      x = anchorRect.right + offset\r\n      y = anchorRect.top + (anchorRect.height - floatingRect.height) / 2\r\n      break\r\n  }\r\n\r\n  // Flip if outside viewport\r\n  if (placement === 'top' && y < 0) {\r\n    y = anchorRect.bottom + offset\r\n    finalPlacement = 'bottom'\r\n  } else if (placement === 'bottom' && y + floatingRect.height > viewport.height) {\r\n    y = anchorRect.top - floatingRect.height - offset\r\n    finalPlacement = 'top'\r\n  } else if (placement === 'left' && x < 0) {\r\n    x = anchorRect.right + offset\r\n    finalPlacement = 'right'\r\n  } else if (placement === 'right' && x + floatingRect.width > viewport.width) {\r\n    x = anchorRect.left - floatingRect.width - offset\r\n    finalPlacement = 'left'\r\n  }\r\n\r\n  // Shift to stay in viewport\r\n  if (finalPlacement === 'top' || finalPlacement === 'bottom') {\r\n    x = Math.max(0, Math.min(x, viewport.width - floatingRect.width))\r\n  } else {\r\n    y = Math.max(0, Math.min(y, viewport.height - floatingRect.height))\r\n  }\r\n\r\n  return { x, y, placement: finalPlacement }\r\n}\r\n","/**\r\n * Keyboard navigation utility for arrow key navigation.\r\n * @module @grimoire/yetzirah-core/utils/key-nav\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Creates keyboard navigation for a set of elements.\r\n * @param {() => HTMLElement[]} getItems - Function returning navigable elements\r\n * @param {Object} options\r\n * @param {'horizontal'|'vertical'} [options.orientation='horizontal']\r\n * @param {boolean} [options.wrap=true]\r\n * @param {boolean} [options.autoActivate=true]\r\n * @param {(item: HTMLElement) => void} [options.onActivate]\r\n * @returns {{ handleKeyDown: (e: KeyboardEvent) => void }}\r\n */\r\nexport function createKeyNav(getItems, options = {}) {\r\n  const { orientation = 'horizontal', wrap = true, autoActivate = true, onActivate } = options\r\n  const prevKey = orientation === 'horizontal' ? 'ArrowLeft' : 'ArrowUp'\r\n  const nextKey = orientation === 'horizontal' ? 'ArrowRight' : 'ArrowDown'\r\n\r\n  return {\r\n    handleKeyDown(e) {\r\n      const items = getItems()\r\n      const currentIndex = items.indexOf(document.activeElement)\r\n      if (currentIndex === -1) return\r\n\r\n      let newIndex = currentIndex\r\n      if (e.key === prevKey) {\r\n        newIndex = currentIndex - 1\r\n        if (newIndex < 0) newIndex = wrap ? items.length - 1 : 0\r\n      } else if (e.key === nextKey) {\r\n        newIndex = currentIndex + 1\r\n        if (newIndex >= items.length) newIndex = wrap ? 0 : items.length - 1\r\n      } else if (e.key === 'Home') {\r\n        newIndex = 0\r\n      } else if (e.key === 'End') {\r\n        newIndex = items.length - 1\r\n      } else {\r\n        return\r\n      }\r\n\r\n      e.preventDefault()\r\n      items[newIndex].focus()\r\n      if (autoActivate && onActivate) onActivate(items[newIndex])\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Click outside utility for dismissing popups.\r\n * @module @grimoire/yetzirah-core/utils/click-outside\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Creates a click outside listener.\r\n * @param {HTMLElement} element - Element to detect clicks outside of\r\n * @param {Function} callback - Called when click outside occurs\r\n * @param {Object} [options]\r\n * @param {HTMLElement} [options.ignore] - Additional element to ignore clicks on (e.g., trigger)\r\n * @returns {{ destroy: () => void }}\r\n */\r\nexport function clickOutside(element, callback, options = {}) {\r\n  const { ignore } = options\r\n\r\n  const handleClick = (e) => {\r\n    if (element.contains(e.target)) return\r\n    if (ignore && ignore.contains(e.target)) return\r\n    callback(e)\r\n  }\r\n\r\n  // Use capture to catch clicks before they're stopped\r\n  document.addEventListener('click', handleClick, true)\r\n\r\n  return {\r\n    destroy() {\r\n      document.removeEventListener('click', handleClick, true)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Idempotent custom element registration utility.\r\n * Prevents duplicate registration errors when scripts load multiple times.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/register\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Register a custom element if not already registered.\r\n * Safe to call multiple times with the same name.\r\n *\r\n * @param {string} name - Custom element tag name (e.g., 'ytz-button')\r\n * @param {CustomElementConstructor} constructor - The element class\r\n */\r\nexport function register(name, constructor) {\r\n  if (!customElements.get(name)) {\r\n    customElements.define(name, constructor)\r\n  }\r\n}\r\n","/**\r\n * ytz-autocomplete - Text input with filterable dropdown selection.\r\n * Supports single and multi-select modes with async loading.\r\n *\r\n * @module @grimoire/yetzirah-core/autocomplete\r\n * @example\r\n * <ytz-autocomplete>\r\n *   <input slot=\"input\" placeholder=\"Search...\">\r\n *   <ytz-option value=\"apple\">Apple</ytz-option>\r\n *   <ytz-option value=\"banana\">Banana</ytz-option>\r\n * </ytz-autocomplete>\r\n *\r\n * @example\r\n * // Multi-select mode\r\n * <ytz-autocomplete multiple>\r\n *   <input slot=\"input\" placeholder=\"Select...\">\r\n *   <ytz-option value=\"a\">Option A</ytz-option>\r\n *   <ytz-option value=\"b\">Option B</ytz-option>\r\n * </ytz-autocomplete>\r\n */\r\n\r\nimport { position } from './utils/position.js'\r\nimport { createKeyNav } from './utils/key-nav.js'\r\nimport { clickOutside } from './utils/click-outside.js'\r\nimport { register } from './utils/register.js'\r\n\r\nlet autocompleteId = 0\r\n\r\n/**\r\n * @class YtzAutocomplete\r\n * @extends HTMLElement\r\n */\r\nclass YtzAutocomplete extends HTMLElement {\r\n  static observedAttributes = ['open', 'multiple', 'loading']\r\n\r\n  /** @type {HTMLInputElement|null} */\r\n  #input = null\r\n  /** @type {HTMLElement|null} */\r\n  #listbox = null\r\n  /** @type {string|null} */\r\n  #listboxId = null\r\n  /** @type {ReturnType<typeof createKeyNav>|null} */\r\n  #keyNav = null\r\n  /** @type {ReturnType<typeof clickOutside>|null} */\r\n  #clickOutsideHandler = null\r\n  /** @type {Set<string>} */\r\n  #selected = new Set()\r\n  /** @type {boolean} - Flag to prevent focus from re-opening after selection */\r\n  #justClosed = false\r\n\r\n  connectedCallback() {\r\n    this.#setup()\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.#cleanup()\r\n  }\r\n\r\n  attributeChangedCallback(name, oldVal, newVal) {\r\n    if (!this.isConnected) return\r\n    if (name === 'open') {\r\n      newVal !== null ? this.#showListbox() : this.#hideListbox()\r\n    }\r\n    if (name === 'loading') {\r\n      this.#updateLoadingState()\r\n    }\r\n  }\r\n\r\n  /** @returns {boolean} */\r\n  get open() { return this.hasAttribute('open') }\r\n  set open(v) { v ? this.setAttribute('open', '') : this.removeAttribute('open') }\r\n\r\n  /** @returns {boolean} */\r\n  get multiple() { return this.hasAttribute('multiple') }\r\n  set multiple(v) { v ? this.setAttribute('multiple', '') : this.removeAttribute('multiple') }\r\n\r\n  /** @returns {boolean} */\r\n  get loading() { return this.hasAttribute('loading') }\r\n  set loading(v) { v ? this.setAttribute('loading', '') : this.removeAttribute('loading') }\r\n\r\n  /** @returns {boolean} */\r\n  get filter() { return this.getAttribute('filter') !== 'false' }\r\n  set filter(v) { this.setAttribute('filter', (v && v !== 'false') ? 'true' : 'false') }\r\n\r\n  /** @returns {string|string[]} */\r\n  get value() {\r\n    return this.multiple ? [...this.#selected] : ([...this.#selected][0] || '')\r\n  }\r\n  set value(v) {\r\n    this.#selected.clear()\r\n    if (Array.isArray(v)) {\r\n      v.forEach(val => this.#selected.add(val))\r\n    } else if (v) {\r\n      this.#selected.add(v)\r\n    }\r\n    this.#updateSelectedState()\r\n  }\r\n\r\n  /** @returns {string} */\r\n  get inputValue() { return this.#input?.value || '' }\r\n  set inputValue(v) { if (this.#input) this.#input.value = v }\r\n\r\n  #setup() {\r\n    this.#input = this.querySelector('[slot=\"input\"]') || this.querySelector('input')\r\n    if (!this.#input) return\r\n\r\n    this.#listboxId = `ytz-autocomplete-${++autocompleteId}`\r\n\r\n    // Create listbox wrapper\r\n    this.#listbox = document.createElement('div')\r\n    this.#listbox.setAttribute('role', 'listbox')\r\n    this.#listbox.id = this.#listboxId\r\n    this.#listbox.hidden = true\r\n    if (this.multiple) {\r\n      this.#listbox.setAttribute('aria-multiselectable', 'true')\r\n    }\r\n\r\n    // Move option children into listbox\r\n    const options = [...this.querySelectorAll('ytz-option')]\r\n    options.forEach(opt => this.#listbox.appendChild(opt))\r\n    this.appendChild(this.#listbox)\r\n\r\n    // ARIA on input\r\n    this.#input.setAttribute('role', 'combobox')\r\n    this.#input.setAttribute('aria-autocomplete', 'list')\r\n    this.#input.setAttribute('aria-controls', this.#listboxId)\r\n    this.#input.setAttribute('aria-expanded', 'false')\r\n    this.#input.setAttribute('aria-haspopup', 'listbox')\r\n\r\n    // Keyboard navigation\r\n    this.#keyNav = createKeyNav(\r\n      () => [...this.#listbox.querySelectorAll('ytz-option:not([hidden]):not([disabled])')],\r\n      { orientation: 'vertical', wrap: true, autoActivate: false }\r\n    )\r\n\r\n    this.#input.addEventListener('input', this.#handleInput)\r\n    this.#input.addEventListener('focus', this.#handleInputFocus)\r\n    this.#input.addEventListener('keydown', this.#handleInputKeyDown)\r\n    this.addEventListener('keydown', this.#handleKeyDown)\r\n    this.addEventListener('option-click', this.#handleOptionClick)\r\n\r\n    // Read initial selected state from HTML\r\n    this.#listbox.querySelectorAll('ytz-option[selected]').forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      if (value) this.#selected.add(value)\r\n    })\r\n    this.#updateSelectedState()\r\n\r\n    // Initialize loading slot visibility\r\n    this.#updateLoadingState()\r\n  }\r\n\r\n  #cleanup() {\r\n    this.#input?.removeEventListener('input', this.#handleInput)\r\n    this.#input?.removeEventListener('focus', this.#handleInputFocus)\r\n    this.#input?.removeEventListener('keydown', this.#handleInputKeyDown)\r\n    this.removeEventListener('keydown', this.#handleKeyDown)\r\n    this.removeEventListener('option-click', this.#handleOptionClick)\r\n    this.#clickOutsideHandler?.destroy()\r\n  }\r\n\r\n  #handleInput = () => {\r\n    if (!this.open) this.open = true\r\n    if (this.filter) this.#filterOptions()\r\n    this.dispatchEvent(new CustomEvent('input-change', {\r\n      bubbles: true,\r\n      detail: { value: this.#input.value }\r\n    }))\r\n  }\r\n\r\n  #handleInputFocus = () => {\r\n    // Don't re-open if we just closed from a selection\r\n    if (this.#justClosed) {\r\n      this.#justClosed = false\r\n      return\r\n    }\r\n    const hasOptions = this.#listbox?.querySelector('ytz-option:not([hidden])')\r\n    if (hasOptions && !this.loading) this.open = true\r\n  }\r\n\r\n  #handleInputKeyDown = (e) => {\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault()\r\n      e.stopPropagation() // Prevent bubbling to #handleKeyDown\r\n      if (!this.open) this.open = true\r\n      const firstOption = this.#listbox?.querySelector('ytz-option:not([hidden]):not([disabled])')\r\n      firstOption?.focus()\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault()\r\n      e.stopPropagation() // Prevent bubbling to #handleKeyDown\r\n      if (!this.open) this.open = true\r\n      const options = this.#listbox?.querySelectorAll('ytz-option:not([hidden]):not([disabled])')\r\n      options?.[options.length - 1]?.focus()\r\n    } else if (e.key === 'Escape' && this.open) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      this.open = false\r\n    } else if (e.key === 'Enter' && this.open) {\r\n      // Select first visible option on Enter from input\r\n      const firstOption = this.#listbox?.querySelector('ytz-option:not([hidden]):not([disabled])')\r\n      if (firstOption) {\r\n        e.preventDefault()\r\n        this.#selectOption(firstOption)\r\n      }\r\n    }\r\n  }\r\n\r\n  #handleKeyDown = (e) => {\r\n    if (!this.open) return\r\n\r\n    if (e.key === 'Escape') {\r\n      e.preventDefault()\r\n      this.open = false\r\n      this.#input?.focus()\r\n      return\r\n    }\r\n\r\n    // Handle navigation when option is focused\r\n    if (document.activeElement?.tagName === 'YTZ-OPTION') {\r\n      this.#keyNav?.handleKeyDown(e)\r\n\r\n      if (e.key === 'Enter' || e.key === ' ') {\r\n        const focused = this.#listbox?.querySelector('ytz-option:focus')\r\n        if (focused && !focused.hasAttribute('disabled')) {\r\n          e.preventDefault()\r\n          this.#selectOption(focused)\r\n        }\r\n      }\r\n\r\n      if (e.key === 'Tab') {\r\n        e.preventDefault()\r\n        this.#input?.focus()\r\n      }\r\n    }\r\n  }\r\n\r\n  #handleOptionClick = (e) => {\r\n    const option = e.detail?.option\r\n    if (option && !option.hasAttribute('disabled')) {\r\n      this.#selectOption(option)\r\n    }\r\n  }\r\n\r\n  #selectOption(option) {\r\n    const value = option.getAttribute('value') || option.textContent?.trim()\r\n    if (!value) return\r\n\r\n    if (this.multiple) {\r\n      if (this.#selected.has(value)) {\r\n        this.#selected.delete(value)\r\n      } else {\r\n        this.#selected.add(value)\r\n      }\r\n    } else {\r\n      this.#selected.clear()\r\n      this.#selected.add(value)\r\n      this.#input.value = option.textContent?.trim() || value\r\n      this.#justClosed = true // Prevent focus from re-opening\r\n      this.open = false\r\n      this.#input?.focus()\r\n    }\r\n\r\n    this.#updateSelectedState()\r\n\r\n    this.dispatchEvent(new CustomEvent('change', {\r\n      bubbles: true,\r\n      detail: { value: this.value, option }\r\n    }))\r\n  }\r\n\r\n  #updateSelectedState() {\r\n    const options = this.#listbox?.querySelectorAll('ytz-option') || []\r\n    options.forEach(opt => {\r\n      const value = opt.getAttribute('value') || opt.textContent?.trim()\r\n      const isSelected = this.#selected.has(value)\r\n      opt.toggleAttribute('selected', isSelected)\r\n      opt.setAttribute('aria-selected', String(isSelected))\r\n    })\r\n  }\r\n\r\n  #filterOptions() {\r\n    const query = this.#input?.value.toLowerCase() || ''\r\n    const options = this.#listbox?.querySelectorAll('ytz-option') || []\r\n\r\n    options.forEach(opt => {\r\n      const text = opt.textContent?.toLowerCase() || ''\r\n      opt.hidden = !text.includes(query)\r\n    })\r\n  }\r\n\r\n  #showListbox() {\r\n    if (!this.#input || !this.#listbox) return\r\n\r\n    this.#listbox.hidden = false\r\n    this.#input.setAttribute('aria-expanded', 'true')\r\n    this.#updatePosition()\r\n\r\n    this.#clickOutsideHandler = clickOutside(this, () => {\r\n      this.open = false\r\n    })\r\n\r\n    window.addEventListener('scroll', this.#updatePosition, { passive: true, capture: true })\r\n    window.addEventListener('resize', this.#updatePosition, { passive: true })\r\n\r\n    this.dispatchEvent(new CustomEvent('open', { bubbles: true }))\r\n  }\r\n\r\n  #hideListbox() {\r\n    if (!this.#input || !this.#listbox) return\r\n\r\n    this.#listbox.hidden = true\r\n    this.#input.setAttribute('aria-expanded', 'false')\r\n\r\n    this.#clickOutsideHandler?.destroy()\r\n    this.#clickOutsideHandler = null\r\n    window.removeEventListener('scroll', this.#updatePosition, { capture: true })\r\n    window.removeEventListener('resize', this.#updatePosition)\r\n\r\n    this.dispatchEvent(new CustomEvent('close', { bubbles: true }))\r\n  }\r\n\r\n  #updatePosition = () => {\r\n    if (!this.#input || !this.#listbox) return\r\n\r\n    const { x, y } = position(this.#input, this.#listbox, {\r\n      placement: 'bottom',\r\n      offset: 4\r\n    })\r\n\r\n    this.#listbox.style.position = 'fixed'\r\n    this.#listbox.style.left = `${x}px`\r\n    this.#listbox.style.top = `${y}px`\r\n    this.#listbox.style.minWidth = `${this.#input.offsetWidth}px`\r\n  }\r\n\r\n  #updateLoadingState() {\r\n    const loadingSlot = this.querySelector('[slot=\"loading\"]')\r\n    if (loadingSlot) {\r\n      loadingSlot.hidden = !this.loading\r\n    }\r\n  }\r\n\r\n  show() { this.open = true }\r\n  hide() { this.open = false }\r\n  toggle() { this.open = !this.open }\r\n\r\n  clear() {\r\n    this.#selected.clear()\r\n    this.#updateSelectedState()\r\n    if (this.#input) this.#input.value = ''\r\n    this.dispatchEvent(new CustomEvent('clear', { bubbles: true }))\r\n  }\r\n\r\n  /**\r\n   * Add options programmatically.\r\n   * @param {Array<{value: string, label: string, disabled?: boolean}>} options\r\n   */\r\n  setOptions(options) {\r\n    if (!this.#listbox) return\r\n    this.#listbox.innerHTML = ''\r\n    options.forEach(({ value, label, disabled }) => {\r\n      const opt = document.createElement('ytz-option')\r\n      opt.setAttribute('value', value)\r\n      opt.textContent = label\r\n      if (disabled) opt.setAttribute('disabled', '')\r\n      this.#listbox.appendChild(opt)\r\n    })\r\n    this.#updateSelectedState()\r\n  }\r\n}\r\n\r\n/**\r\n * ytz-option - Individual option in autocomplete.\r\n * @attr value - Option value\r\n * @attr disabled - When present, option is not selectable\r\n * @attr selected - When present, option is selected\r\n */\r\nclass YtzOption extends HTMLElement {\r\n  connectedCallback() {\r\n    this.setAttribute('role', 'option')\r\n    if (!this.hasAttribute('tabindex') && !this.hasAttribute('disabled')) {\r\n      this.setAttribute('tabindex', '-1')\r\n    }\r\n    if (this.hasAttribute('disabled')) {\r\n      this.setAttribute('aria-disabled', 'true')\r\n    }\r\n    this.setAttribute('aria-selected', this.hasAttribute('selected') ? 'true' : 'false')\r\n    this.addEventListener('click', this.#handleClick)\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.removeEventListener('click', this.#handleClick)\r\n  }\r\n\r\n  #handleClick = (e) => {\r\n    if (this.hasAttribute('disabled')) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      return\r\n    }\r\n    this.dispatchEvent(new CustomEvent('option-click', {\r\n      bubbles: true,\r\n      detail: { option: this }\r\n    }))\r\n  }\r\n\r\n  /** @returns {boolean} */\r\n  get disabled() { return this.hasAttribute('disabled') }\r\n  set disabled(v) {\r\n    if (v) {\r\n      this.setAttribute('disabled', '')\r\n      this.setAttribute('aria-disabled', 'true')\r\n      this.removeAttribute('tabindex')\r\n    } else {\r\n      this.removeAttribute('disabled')\r\n      this.removeAttribute('aria-disabled')\r\n      this.setAttribute('tabindex', '-1')\r\n    }\r\n  }\r\n\r\n  /** @returns {boolean} */\r\n  get selected() { return this.hasAttribute('selected') }\r\n  set selected(v) {\r\n    v ? this.setAttribute('selected', '') : this.removeAttribute('selected')\r\n    this.setAttribute('aria-selected', String(v))\r\n  }\r\n\r\n  /** @returns {string|null} */\r\n  get value() { return this.getAttribute('value') }\r\n  set value(v) { v ? this.setAttribute('value', v) : this.removeAttribute('value') }\r\n}\r\n\r\nregister('ytz-autocomplete', YtzAutocomplete)\r\nregister('ytz-option', YtzOption)\r\n\r\nexport { YtzAutocomplete, YtzOption }\r\n"]}