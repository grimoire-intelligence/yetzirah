{"version":3,"sources":["../src/utils/virtual-scroll.js","../src/utils/register.js","../src/datagrid.js"],"names":["createVirtualScroller","container","content","itemCount","itemHeight","renderItem","buffer","scrollTop","renderedRange","rafId","totalHeight","calculateVisibleRange","containerHeight","start","visibleCount","end","render","range","i","item","handleScroll","scrollToIndex","index","targetTop","currentScrollTop","destroy","refresh","newTotalHeight","register","name","constructor","YtzDatagridColumn","val","YtzDatagrid","#data","#filteredData","#columns","#sortState","#filterState","#virtualScroller","#header","#body","#viewport","#focusedRow","#focusedCol","#columnWidths","#resizeState","#setup","#handleKeydown","#handleResizeMove","#handleResizeEnd","#render","#createStructure","columns","col","#renderHeader","#applyFiltersAndSort","#initVirtualScroller","cell","storedWidth","e","#handleSort","indicator","input","resizeHandle","#handleResizeStart","field","headerCell","startX","startWidth","delta","newWidth","#updateBodyColumnWidths","#extractNumber","value","cleaned","num","row","colIndex","result","searchLower","direction","a","b","aVal","bVal","aNum","bNum","cmp","rowHeight","#renderRow","rowData","#updateFocus","maxRow","maxCol","#applyFocusStyling","targetRow","headers","rows","filename","csv","blob","url","link"],"mappings":"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","file":"datagrid.js","sourcesContent":["/**\n * Virtual Scroll utility for efficient rendering of large lists.\n * Only renders visible items plus a buffer for smooth scrolling.\n *\n * @module @grimoire/yetzirah-core/utils/virtual-scroll\n */\n\n/**\n * Create a virtual scroller instance.\n * @param {Object} options - Configuration options\n * @param {HTMLElement} options.container - Scrollable container element\n * @param {HTMLElement} options.content - Content element to hold rendered items\n * @param {number} options.itemCount - Total number of items\n * @param {number} options.itemHeight - Height of each item in pixels\n * @param {Function} options.renderItem - Function to render an item by index\n * @param {number} [options.buffer=5] - Number of items to render above/below viewport\n * @returns {Object} Virtual scroller instance\n */\nexport function createVirtualScroller({\n  container,\n  content,\n  itemCount,\n  itemHeight,\n  renderItem,\n  buffer = 5\n}) {\n  let scrollTop = 0\n  let renderedRange = { start: 0, end: 0 }\n  let rafId = null\n\n  // Set up content height to enable scrolling\n  const totalHeight = itemCount * itemHeight\n  content.style.height = `${totalHeight}px`\n  content.style.position = 'relative'\n\n  function calculateVisibleRange() {\n    const containerHeight = container.clientHeight\n    const start = Math.max(0, Math.floor(scrollTop / itemHeight) - buffer)\n    const visibleCount = Math.ceil(containerHeight / itemHeight)\n    const end = Math.min(itemCount, start + visibleCount + buffer * 2)\n    return { start, end }\n  }\n\n  function render() {\n    const range = calculateVisibleRange()\n\n    // Skip if range hasn't changed\n    if (range.start === renderedRange.start && range.end === renderedRange.end) {\n      return\n    }\n\n    renderedRange = range\n\n    // Clear and re-render\n    content.innerHTML = ''\n\n    for (let i = range.start; i < range.end; i++) {\n      const item = renderItem(i)\n      if (item) {\n        item.style.position = 'absolute'\n        item.style.top = `${i * itemHeight}px`\n        item.style.height = `${itemHeight}px`\n        item.style.left = '0'\n        item.style.right = '0'\n        content.appendChild(item)\n      }\n    }\n  }\n\n  function handleScroll() {\n    scrollTop = container.scrollTop\n\n    // Use RAF for smooth rendering\n    if (rafId) {\n      cancelAnimationFrame(rafId)\n    }\n    rafId = requestAnimationFrame(render)\n  }\n\n  function scrollToIndex(index) {\n    const targetTop = index * itemHeight\n    const containerHeight = container.clientHeight\n    const currentScrollTop = container.scrollTop\n\n    // Only scroll if item is not fully visible\n    if (targetTop < currentScrollTop) {\n      container.scrollTop = targetTop\n    } else if (targetTop + itemHeight > currentScrollTop + containerHeight) {\n      container.scrollTop = targetTop - containerHeight + itemHeight\n    }\n  }\n\n  function destroy() {\n    container.removeEventListener('scroll', handleScroll)\n    if (rafId) {\n      cancelAnimationFrame(rafId)\n    }\n    content.innerHTML = ''\n  }\n\n  function refresh() {\n    const newTotalHeight = itemCount * itemHeight\n    content.style.height = `${newTotalHeight}px`\n    renderedRange = { start: 0, end: 0 }\n    render()\n  }\n\n  // Initialize\n  container.addEventListener('scroll', handleScroll)\n  render()\n\n  return {\n    scrollToIndex,\n    refresh,\n    destroy,\n    get renderedRange() {\n      return { ...renderedRange }\n    }\n  }\n}\n","/**\n * Idempotent custom element registration utility.\n * Prevents duplicate registration errors when scripts load multiple times.\n *\n * @module @grimoire/yetzirah-core/utils/register\n * @internal Not exported from package\n */\n\n/**\n * Register a custom element if not already registered.\n * Safe to call multiple times with the same name.\n *\n * @param {string} name - Custom element tag name (e.g., 'ytz-button')\n * @param {CustomElementConstructor} constructor - The element class\n */\nexport function register(name, constructor) {\n  if (!customElements.get(name)) {\n    customElements.define(name, constructor)\n  }\n}\n","/**\n * ytz-datagrid - Data Grid Web Component.\n * Virtual scrolling, sorting, filtering, keyboard navigation, and export.\n *\n * @module @grimoire/yetzirah-core/datagrid\n * @example\n * <ytz-datagrid>\n *   <ytz-datagrid-column field=\"name\" header=\"Name\" sortable></ytz-datagrid-column>\n *   <ytz-datagrid-column field=\"email\" header=\"Email\"></ytz-datagrid-column>\n * </ytz-datagrid>\n *\n * // Set data via JavaScript:\n * grid.data = [{ name: 'John', email: 'john@example.com' }, ...]\n */\n\nimport { createVirtualScroller } from './utils/virtual-scroll.js'\nimport { register } from './utils/register.js'\n\n/**\n * @class YtzDatagridColumn\n * @extends HTMLElement\n */\nclass YtzDatagridColumn extends HTMLElement {\n  get field() { return this.getAttribute('field') || '' }\n  set field(val) { this.setAttribute('field', val) }\n\n  get header() { return this.getAttribute('header') || this.field }\n  set header(val) { this.setAttribute('header', val) }\n\n  get sortable() { return this.hasAttribute('sortable') }\n  set sortable(val) { val ? this.setAttribute('sortable', '') : this.removeAttribute('sortable') }\n\n  get filterable() { return this.hasAttribute('filterable') }\n  set filterable(val) { val ? this.setAttribute('filterable', '') : this.removeAttribute('filterable') }\n\n  get width() { return this.getAttribute('width') || 'auto' }\n  set width(val) { this.setAttribute('width', val) }\n}\n\nregister('ytz-datagrid-column', YtzDatagridColumn)\n\n/**\n * @class YtzDatagrid\n * @extends HTMLElement\n */\nclass YtzDatagrid extends HTMLElement {\n  static observedAttributes = ['row-height', 'page-size']\n\n  /** @type {Array<Object>} */\n  #data = []\n  /** @type {Array<Object>} */\n  #filteredData = []\n  /** @type {Array<YtzDatagridColumn>} */\n  #columns = []\n  /** @type {Object|null} */\n  #sortState = null\n  /** @type {Object} */\n  #filterState = {}\n  /** @type {Object|null} */\n  #virtualScroller = null\n  /** @type {HTMLElement|null} */\n  #header = null\n  /** @type {HTMLElement|null} */\n  #body = null\n  /** @type {HTMLElement|null} */\n  #viewport = null\n  /** @type {number} */\n  #focusedRow = 0\n  /** @type {number} */\n  #focusedCol = 0\n  /** @type {Map<string, number>} */\n  #columnWidths = new Map()\n  /** @type {Object|null} */\n  #resizeState = null\n\n  connectedCallback() {\n    this.#setup()\n  }\n\n  disconnectedCallback() {\n    this.#virtualScroller?.destroy()\n    this.removeEventListener('keydown', this.#handleKeydown)\n    document.removeEventListener('mousemove', this.#handleResizeMove)\n    document.removeEventListener('mouseup', this.#handleResizeEnd)\n  }\n\n  attributeChangedCallback() {\n    if (this.isConnected) {\n      this.#render()\n    }\n  }\n\n  #setup() {\n    // Collect column definitions\n    this.#columns = Array.from(this.querySelectorAll('ytz-datagrid-column'))\n\n    // Set up ARIA\n    this.setAttribute('role', 'grid')\n    if (!this.hasAttribute('tabindex')) {\n      this.setAttribute('tabindex', '0')\n    }\n\n    // Create structure\n    this.#createStructure()\n\n    // Event listeners\n    this.addEventListener('keydown', this.#handleKeydown)\n\n    // Initial render\n    this.#render()\n  }\n\n  #createStructure() {\n    // Clear existing content (except columns)\n    const columns = Array.from(this.querySelectorAll('ytz-datagrid-column'))\n    this.innerHTML = ''\n    columns.forEach(col => this.appendChild(col))\n\n    // Create header\n    this.#header = document.createElement('div')\n    this.#header.className = 'ytz-datagrid-header'\n    this.#header.setAttribute('role', 'row')\n    this.appendChild(this.#header)\n\n    // Create viewport for virtual scrolling\n    this.#viewport = document.createElement('div')\n    this.#viewport.className = 'ytz-datagrid-viewport'\n    this.appendChild(this.#viewport)\n\n    // Create body container\n    this.#body = document.createElement('div')\n    this.#body.className = 'ytz-datagrid-body'\n    this.#body.setAttribute('role', 'rowgroup')\n    this.#viewport.appendChild(this.#body)\n  }\n\n  #render() {\n    this.#renderHeader()\n    this.#applyFiltersAndSort()\n    this.#initVirtualScroller()\n  }\n\n  #renderHeader() {\n    if (!this.#header) return\n\n    this.#header.innerHTML = ''\n\n    this.#columns.forEach((col, index) => {\n      const cell = document.createElement('div')\n      cell.className = 'ytz-datagrid-header-cell'\n      cell.setAttribute('role', 'columnheader')\n      cell.setAttribute('data-field', col.field)\n\n      // Use stored width or fall back to column attribute\n      const storedWidth = this.#columnWidths.get(col.field)\n      if (storedWidth) {\n        cell.style.width = `${storedWidth}px`\n        cell.style.flex = 'none'\n      } else if (col.width && col.width !== 'auto') {\n        cell.style.width = col.width\n        cell.style.flex = 'none'\n      }\n\n      // Create content wrapper to keep text separate from resize handle\n      const content = document.createElement('span')\n      content.className = 'ytz-datagrid-header-content'\n      content.textContent = col.header\n      cell.appendChild(content)\n\n      if (col.sortable) {\n        cell.classList.add('ytz-datagrid-sortable')\n        cell.addEventListener('click', (e) => {\n          // Don't sort when clicking resize handle\n          if (e.target.classList.contains('ytz-datagrid-resize-handle')) return\n          this.#handleSort(col.field)\n        })\n\n        // Add sort indicator\n        const indicator = document.createElement('span')\n        indicator.className = 'ytz-datagrid-sort-indicator'\n        if (this.#sortState?.field === col.field) {\n          indicator.textContent = this.#sortState.direction === 'asc' ? ' \\u25B2' : ' \\u25BC'\n          cell.setAttribute('aria-sort', this.#sortState.direction === 'asc' ? 'ascending' : 'descending')\n        }\n        content.appendChild(indicator)\n      }\n\n      if (col.filterable) {\n        const input = document.createElement('input')\n        input.type = 'text'\n        input.className = 'ytz-datagrid-filter'\n        input.placeholder = `Filter ${col.header}...`\n        input.value = this.#filterState[col.field] || ''\n        input.addEventListener('input', (e) => {\n          this.#filterState[col.field] = e.target.value\n          this.#applyFiltersAndSort()\n          this.#initVirtualScroller()\n        })\n        input.addEventListener('click', (e) => e.stopPropagation())\n        cell.appendChild(input)\n      }\n\n      // Add resize handle\n      const resizeHandle = document.createElement('div')\n      resizeHandle.className = 'ytz-datagrid-resize-handle'\n      resizeHandle.addEventListener('mousedown', (e) => this.#handleResizeStart(e, col.field, cell))\n      cell.appendChild(resizeHandle)\n\n      this.#header.appendChild(cell)\n    })\n  }\n\n  #handleResizeStart(e, field, headerCell) {\n    e.preventDefault()\n    e.stopPropagation()\n\n    const startX = e.clientX\n    const startWidth = headerCell.offsetWidth\n\n    this.#resizeState = { field, startX, startWidth, headerCell }\n\n    document.addEventListener('mousemove', this.#handleResizeMove)\n    document.addEventListener('mouseup', this.#handleResizeEnd)\n\n    // Add resizing class for visual feedback\n    this.classList.add('ytz-datagrid-resizing')\n  }\n\n  #handleResizeMove = (e) => {\n    if (!this.#resizeState) return\n\n    const { field, startX, startWidth, headerCell } = this.#resizeState\n    const delta = e.clientX - startX\n    const newWidth = Math.max(50, startWidth + delta) // Minimum 50px\n\n    // Update header cell width\n    headerCell.style.width = `${newWidth}px`\n    headerCell.style.flex = 'none'\n\n    // Update body cells width\n    this.#columnWidths.set(field, newWidth)\n    this.#updateBodyColumnWidths()\n  }\n\n  #handleResizeEnd = () => {\n    if (this.#resizeState) {\n      this.dispatchEvent(new CustomEvent('columnresize', {\n        bubbles: true,\n        detail: {\n          field: this.#resizeState.field,\n          width: this.#columnWidths.get(this.#resizeState.field)\n        }\n      }))\n    }\n\n    this.#resizeState = null\n    document.removeEventListener('mousemove', this.#handleResizeMove)\n    document.removeEventListener('mouseup', this.#handleResizeEnd)\n    this.classList.remove('ytz-datagrid-resizing')\n  }\n\n  /**\n   * Extract a numeric value from a string, handling currency, percentages, etc.\n   * @param {*} value - The value to parse\n   * @returns {number|null} - The numeric value or null if not parseable\n   */\n  #extractNumber(value) {\n    if (typeof value === 'number') return value\n    if (typeof value !== 'string') return null\n\n    // Remove currency symbols, commas, spaces, and percentage signs\n    const cleaned = value.replace(/[$€£¥,\\s%]/g, '')\n\n    // Check if it looks like a number (possibly negative, possibly decimal)\n    if (!/^-?\\d+\\.?\\d*$/.test(cleaned)) return null\n\n    const num = parseFloat(cleaned)\n    return isNaN(num) ? null : num\n  }\n\n  #updateBodyColumnWidths() {\n    const rows = this.querySelectorAll('.ytz-datagrid-row')\n    rows.forEach(row => {\n      this.#columns.forEach((col, colIndex) => {\n        const cell = row.querySelector(`[data-col-index=\"${colIndex}\"]`)\n        if (cell) {\n          const storedWidth = this.#columnWidths.get(col.field)\n          if (storedWidth) {\n            cell.style.width = `${storedWidth}px`\n            cell.style.flex = 'none'\n          }\n        }\n      })\n    })\n  }\n\n  #handleSort(field) {\n    if (this.#sortState?.field === field) {\n      if (this.#sortState.direction === 'asc') {\n        this.#sortState.direction = 'desc'\n      } else if (this.#sortState.direction === 'desc') {\n        this.#sortState = null\n      }\n    } else {\n      this.#sortState = { field, direction: 'asc' }\n    }\n\n    this.#applyFiltersAndSort()\n    this.#renderHeader()\n    this.#initVirtualScroller()\n\n    this.dispatchEvent(new CustomEvent('sort', {\n      bubbles: true,\n      detail: { ...this.#sortState }\n    }))\n  }\n\n  #applyFiltersAndSort() {\n    let result = [...this.#data]\n\n    // Apply filters\n    for (const [field, value] of Object.entries(this.#filterState)) {\n      if (value) {\n        const searchLower = value.toLowerCase()\n        result = result.filter(row => {\n          const cellValue = String(row[field] ?? '').toLowerCase()\n          return cellValue.includes(searchLower)\n        })\n      }\n    }\n\n    // Apply sort\n    if (this.#sortState) {\n      const { field, direction } = this.#sortState\n      result.sort((a, b) => {\n        const aVal = a[field] ?? ''\n        const bVal = b[field] ?? ''\n\n        // Try to extract numeric values (handles currency, percentages, etc.)\n        const aNum = this.#extractNumber(aVal)\n        const bNum = this.#extractNumber(bVal)\n\n        let cmp\n        if (aNum !== null && bNum !== null) {\n          // Both values are numeric - compare as numbers\n          cmp = aNum - bNum\n        } else {\n          // Fall back to string comparison\n          cmp = String(aVal).localeCompare(String(bVal), undefined, { numeric: true })\n        }\n\n        return direction === 'asc' ? cmp : -cmp\n      })\n    }\n\n    this.#filteredData = result\n  }\n\n  #initVirtualScroller() {\n    // Guard: ensure DOM structure is ready\n    if (!this.#viewport || !this.#body) return\n\n    this.#virtualScroller?.destroy()\n\n    const rowHeight = parseInt(this.getAttribute('row-height')) || 40\n\n    this.#virtualScroller = createVirtualScroller({\n      container: this.#viewport,\n      content: this.#body,\n      itemCount: this.#filteredData.length,\n      itemHeight: rowHeight,\n      renderItem: (index) => this.#renderRow(index)\n    })\n  }\n\n  #renderRow(index) {\n    const rowData = this.#filteredData[index]\n    if (!rowData) return null\n\n    const row = document.createElement('div')\n    row.className = 'ytz-datagrid-row'\n    row.setAttribute('role', 'row')\n    row.setAttribute('data-row-index', String(index))\n    row.tabIndex = -1\n\n    this.#columns.forEach((col, colIndex) => {\n      const cell = document.createElement('div')\n      cell.className = 'ytz-datagrid-cell'\n      cell.setAttribute('role', 'gridcell')\n\n      // Use stored width or fall back to column attribute\n      const storedWidth = this.#columnWidths.get(col.field)\n      if (storedWidth) {\n        cell.style.width = `${storedWidth}px`\n        cell.style.flex = 'none'\n      } else if (col.width && col.width !== 'auto') {\n        cell.style.width = col.width\n        cell.style.flex = 'none'\n      }\n\n      cell.textContent = String(rowData[col.field] ?? '')\n      cell.setAttribute('data-col-index', String(colIndex))\n      row.appendChild(cell)\n    })\n\n    row.addEventListener('click', (e) => {\n      this.#focusedRow = index\n      // Determine which cell was clicked\n      const cell = e.target.closest('.ytz-datagrid-cell')\n      if (cell) {\n        const colIndex = parseInt(cell.getAttribute('data-col-index'), 10)\n        if (!isNaN(colIndex)) {\n          this.#focusedCol = colIndex\n        }\n      }\n      this.#updateFocus()\n      this.dispatchEvent(new CustomEvent('rowselect', {\n        bubbles: true,\n        detail: { row: rowData, index }\n      }))\n    })\n\n    return row\n  }\n\n  #handleKeydown = (e) => {\n    const maxRow = this.#filteredData.length - 1\n    const maxCol = this.#columns.length - 1\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault()\n        this.#focusedRow = Math.min(maxRow, this.#focusedRow + 1)\n        this.#updateFocus()\n        break\n      case 'ArrowUp':\n        e.preventDefault()\n        this.#focusedRow = Math.max(0, this.#focusedRow - 1)\n        this.#updateFocus()\n        break\n      case 'ArrowRight':\n        e.preventDefault()\n        this.#focusedCol = Math.min(maxCol, this.#focusedCol + 1)\n        this.#updateFocus()\n        break\n      case 'ArrowLeft':\n        e.preventDefault()\n        this.#focusedCol = Math.max(0, this.#focusedCol - 1)\n        this.#updateFocus()\n        break\n      case 'Home':\n        e.preventDefault()\n        if (e.ctrlKey) {\n          this.#focusedRow = 0\n        }\n        this.#focusedCol = 0\n        this.#updateFocus()\n        break\n      case 'End':\n        e.preventDefault()\n        if (e.ctrlKey) {\n          this.#focusedRow = maxRow\n        }\n        this.#focusedCol = maxCol\n        this.#updateFocus()\n        break\n      case 'PageDown':\n        e.preventDefault()\n        this.#focusedRow = Math.min(maxRow, this.#focusedRow + 10)\n        this.#updateFocus()\n        break\n      case 'PageUp':\n        e.preventDefault()\n        this.#focusedRow = Math.max(0, this.#focusedRow - 10)\n        this.#updateFocus()\n        break\n      case 'Enter':\n        e.preventDefault()\n        this.dispatchEvent(new CustomEvent('rowactivate', {\n          bubbles: true,\n          detail: { row: this.#filteredData[this.#focusedRow], index: this.#focusedRow }\n        }))\n        break\n    }\n  }\n\n  #updateFocus() {\n    // Scroll row into view via virtual scroller\n    this.#virtualScroller?.scrollToIndex(this.#focusedRow)\n\n    // Apply focus styling after any scroll-triggered re-render completes\n    // (scrollToIndex may trigger scroll event → RAF render that clears DOM)\n    requestAnimationFrame(() => {\n      this.#applyFocusStyling()\n    })\n  }\n\n  #applyFocusStyling() {\n    // Update row focus styling\n    this.querySelectorAll('.ytz-datagrid-row').forEach(row => {\n      row.classList.remove('ytz-datagrid-row-focused')\n    })\n\n    const targetRow = this.querySelector(`[data-row-index=\"${this.#focusedRow}\"]`)\n    targetRow?.classList.add('ytz-datagrid-row-focused')\n\n    // Update cell focus\n    this.querySelectorAll('.ytz-datagrid-cell').forEach(cell => {\n      cell.classList.remove('ytz-datagrid-cell-focused')\n    })\n\n    const targetCell = targetRow?.querySelector(`[data-col-index=\"${this.#focusedCol}\"]`)\n    targetCell?.classList.add('ytz-datagrid-cell-focused')\n  }\n\n  /**\n   * Export data to CSV format.\n   * @returns {string} CSV string\n   */\n  exportCSV() {\n    const headers = this.#columns.map(col => `\"${col.header.replace(/\"/g, '\"\"')}\"`)\n    const rows = this.#filteredData.map(row => {\n      return this.#columns.map(col => {\n        const value = String(row[col.field] ?? '')\n        return `\"${value.replace(/\"/g, '\"\"')}\"`\n      }).join(',')\n    })\n    return [headers.join(','), ...rows].join('\\n')\n  }\n\n  /**\n   * Download data as CSV file.\n   * @param {string} filename - File name (default: 'data.csv')\n   */\n  downloadCSV(filename = 'data.csv') {\n    const csv = this.exportCSV()\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })\n    const url = URL.createObjectURL(blob)\n    const link = document.createElement('a')\n    link.href = url\n    link.download = filename\n    link.click()\n    URL.revokeObjectURL(url)\n  }\n\n  // Property accessors\n  get data() {\n    return this.#data\n  }\n\n  set data(value) {\n    this.#data = Array.isArray(value) ? value : []\n    this.#applyFiltersAndSort()\n    this.#initVirtualScroller()\n  }\n\n  get sortState() {\n    return this.#sortState ? { ...this.#sortState } : null\n  }\n\n  get filteredData() {\n    return [...this.#filteredData]\n  }\n}\n\nregister('ytz-datagrid', YtzDatagrid)\n\nexport { YtzDatagrid, YtzDatagridColumn }\n"]}