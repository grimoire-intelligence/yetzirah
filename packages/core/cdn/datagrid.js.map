{"version":3,"sources":["../src/utils/virtual-scroll.js","../src/utils/register.js","../src/datagrid.js"],"names":["createVirtualScroller","container","content","itemCount","itemHeight","renderItem","buffer","scrollTop","renderedRange","rafId","totalHeight","calculateVisibleRange","containerHeight","start","visibleCount","end","render","range","i","item","handleScroll","scrollToIndex","index","targetTop","currentScrollTop","destroy","refresh","newTotalHeight","register","name","constructor","YtzDatagridColumn","val","YtzDatagrid","#data","#filteredData","#columns","#sortState","#filterState","#virtualScroller","#header","#body","#viewport","#focusedRow","#focusedCol","#columnWidths","#resizeState","#setup","#handleKeydown","#handleResizeMove","#handleResizeEnd","#render","#createStructure","columns","col","#renderHeader","#applyFiltersAndSort","#initVirtualScroller","cell","storedWidth","e","#handleSort","indicator","input","resizeHandle","#handleResizeStart","field","headerCell","startX","startWidth","delta","newWidth","#updateBodyColumnWidths","#extractNumber","value","cleaned","num","row","colIndex","result","searchLower","direction","a","b","aVal","bVal","aNum","bNum","cmp","rowHeight","#renderRow","rowData","#updateFocus","maxRow","maxCol","#applyFocusStyling","targetRow","headers","rows","filename","csv","blob","url","link"],"mappings":"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","file":"datagrid.js","sourcesContent":["/**\r\n * Virtual Scroll utility for efficient rendering of large lists.\r\n * Only renders visible items plus a buffer for smooth scrolling.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/virtual-scroll\r\n */\r\n\r\n/**\r\n * Create a virtual scroller instance.\r\n * @param {Object} options - Configuration options\r\n * @param {HTMLElement} options.container - Scrollable container element\r\n * @param {HTMLElement} options.content - Content element to hold rendered items\r\n * @param {number} options.itemCount - Total number of items\r\n * @param {number} options.itemHeight - Height of each item in pixels\r\n * @param {Function} options.renderItem - Function to render an item by index\r\n * @param {number} [options.buffer=5] - Number of items to render above/below viewport\r\n * @returns {Object} Virtual scroller instance\r\n */\r\nexport function createVirtualScroller({\r\n  container,\r\n  content,\r\n  itemCount,\r\n  itemHeight,\r\n  renderItem,\r\n  buffer = 5\r\n}) {\r\n  let scrollTop = 0\r\n  let renderedRange = { start: 0, end: 0 }\r\n  let rafId = null\r\n\r\n  // Set up content height to enable scrolling\r\n  const totalHeight = itemCount * itemHeight\r\n  content.style.height = `${totalHeight}px`\r\n  content.style.position = 'relative'\r\n\r\n  function calculateVisibleRange() {\r\n    const containerHeight = container.clientHeight\r\n    const start = Math.max(0, Math.floor(scrollTop / itemHeight) - buffer)\r\n    const visibleCount = Math.ceil(containerHeight / itemHeight)\r\n    const end = Math.min(itemCount, start + visibleCount + buffer * 2)\r\n    return { start, end }\r\n  }\r\n\r\n  function render() {\r\n    const range = calculateVisibleRange()\r\n\r\n    // Skip if range hasn't changed\r\n    if (range.start === renderedRange.start && range.end === renderedRange.end) {\r\n      return\r\n    }\r\n\r\n    renderedRange = range\r\n\r\n    // Clear and re-render\r\n    content.innerHTML = ''\r\n\r\n    for (let i = range.start; i < range.end; i++) {\r\n      const item = renderItem(i)\r\n      if (item) {\r\n        item.style.position = 'absolute'\r\n        item.style.top = `${i * itemHeight}px`\r\n        item.style.height = `${itemHeight}px`\r\n        item.style.left = '0'\r\n        item.style.right = '0'\r\n        content.appendChild(item)\r\n      }\r\n    }\r\n  }\r\n\r\n  function handleScroll() {\r\n    scrollTop = container.scrollTop\r\n\r\n    // Use RAF for smooth rendering\r\n    if (rafId) {\r\n      cancelAnimationFrame(rafId)\r\n    }\r\n    rafId = requestAnimationFrame(render)\r\n  }\r\n\r\n  function scrollToIndex(index) {\r\n    const targetTop = index * itemHeight\r\n    const containerHeight = container.clientHeight\r\n    const currentScrollTop = container.scrollTop\r\n\r\n    // Only scroll if item is not fully visible\r\n    if (targetTop < currentScrollTop) {\r\n      container.scrollTop = targetTop\r\n    } else if (targetTop + itemHeight > currentScrollTop + containerHeight) {\r\n      container.scrollTop = targetTop - containerHeight + itemHeight\r\n    }\r\n  }\r\n\r\n  function destroy() {\r\n    container.removeEventListener('scroll', handleScroll)\r\n    if (rafId) {\r\n      cancelAnimationFrame(rafId)\r\n    }\r\n    content.innerHTML = ''\r\n  }\r\n\r\n  function refresh() {\r\n    const newTotalHeight = itemCount * itemHeight\r\n    content.style.height = `${newTotalHeight}px`\r\n    renderedRange = { start: 0, end: 0 }\r\n    render()\r\n  }\r\n\r\n  // Initialize\r\n  container.addEventListener('scroll', handleScroll)\r\n  render()\r\n\r\n  return {\r\n    scrollToIndex,\r\n    refresh,\r\n    destroy,\r\n    get renderedRange() {\r\n      return { ...renderedRange }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Idempotent custom element registration utility.\r\n * Prevents duplicate registration errors when scripts load multiple times.\r\n *\r\n * @module @grimoire/yetzirah-core/utils/register\r\n * @internal Not exported from package\r\n */\r\n\r\n/**\r\n * Register a custom element if not already registered.\r\n * Safe to call multiple times with the same name.\r\n *\r\n * @param {string} name - Custom element tag name (e.g., 'ytz-button')\r\n * @param {CustomElementConstructor} constructor - The element class\r\n */\r\nexport function register(name, constructor) {\r\n  if (!customElements.get(name)) {\r\n    customElements.define(name, constructor)\r\n  }\r\n}\r\n","/**\r\n * ytz-datagrid - Data Grid Web Component.\r\n * Virtual scrolling, sorting, filtering, keyboard navigation, and export.\r\n *\r\n * @module @grimoire/yetzirah-core/datagrid\r\n * @example\r\n * <ytz-datagrid>\r\n *   <ytz-datagrid-column field=\"name\" header=\"Name\" sortable></ytz-datagrid-column>\r\n *   <ytz-datagrid-column field=\"email\" header=\"Email\"></ytz-datagrid-column>\r\n * </ytz-datagrid>\r\n *\r\n * // Set data via JavaScript:\r\n * grid.data = [{ name: 'John', email: 'john@example.com' }, ...]\r\n */\r\n\r\nimport { createVirtualScroller } from './utils/virtual-scroll.js'\r\nimport { register } from './utils/register.js'\r\n\r\n/**\r\n * @class YtzDatagridColumn\r\n * @extends HTMLElement\r\n */\r\nclass YtzDatagridColumn extends HTMLElement {\r\n  get field() { return this.getAttribute('field') || '' }\r\n  set field(val) { this.setAttribute('field', val) }\r\n\r\n  get header() { return this.getAttribute('header') || this.field }\r\n  set header(val) { this.setAttribute('header', val) }\r\n\r\n  get sortable() { return this.hasAttribute('sortable') }\r\n  set sortable(val) { val ? this.setAttribute('sortable', '') : this.removeAttribute('sortable') }\r\n\r\n  get filterable() { return this.hasAttribute('filterable') }\r\n  set filterable(val) { val ? this.setAttribute('filterable', '') : this.removeAttribute('filterable') }\r\n\r\n  get width() { return this.getAttribute('width') || 'auto' }\r\n  set width(val) { this.setAttribute('width', val) }\r\n}\r\n\r\nregister('ytz-datagrid-column', YtzDatagridColumn)\r\n\r\n/**\r\n * @class YtzDatagrid\r\n * @extends HTMLElement\r\n */\r\nclass YtzDatagrid extends HTMLElement {\r\n  static observedAttributes = ['row-height', 'page-size']\r\n\r\n  /** @type {Array<Object>} */\r\n  #data = []\r\n  /** @type {Array<Object>} */\r\n  #filteredData = []\r\n  /** @type {Array<YtzDatagridColumn>} */\r\n  #columns = []\r\n  /** @type {Object|null} */\r\n  #sortState = null\r\n  /** @type {Object} */\r\n  #filterState = {}\r\n  /** @type {Object|null} */\r\n  #virtualScroller = null\r\n  /** @type {HTMLElement|null} */\r\n  #header = null\r\n  /** @type {HTMLElement|null} */\r\n  #body = null\r\n  /** @type {HTMLElement|null} */\r\n  #viewport = null\r\n  /** @type {number} */\r\n  #focusedRow = 0\r\n  /** @type {number} */\r\n  #focusedCol = 0\r\n  /** @type {Map<string, number>} */\r\n  #columnWidths = new Map()\r\n  /** @type {Object|null} */\r\n  #resizeState = null\r\n\r\n  connectedCallback() {\r\n    this.#setup()\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.#virtualScroller?.destroy()\r\n    this.removeEventListener('keydown', this.#handleKeydown)\r\n    document.removeEventListener('mousemove', this.#handleResizeMove)\r\n    document.removeEventListener('mouseup', this.#handleResizeEnd)\r\n  }\r\n\r\n  attributeChangedCallback() {\r\n    if (this.isConnected) {\r\n      this.#render()\r\n    }\r\n  }\r\n\r\n  #setup() {\r\n    // Collect column definitions\r\n    this.#columns = Array.from(this.querySelectorAll('ytz-datagrid-column'))\r\n\r\n    // Set up ARIA\r\n    this.setAttribute('role', 'grid')\r\n    if (!this.hasAttribute('tabindex')) {\r\n      this.setAttribute('tabindex', '0')\r\n    }\r\n\r\n    // Create structure\r\n    this.#createStructure()\r\n\r\n    // Event listeners\r\n    this.addEventListener('keydown', this.#handleKeydown)\r\n\r\n    // Initial render\r\n    this.#render()\r\n  }\r\n\r\n  #createStructure() {\r\n    // Clear existing content (except columns)\r\n    const columns = Array.from(this.querySelectorAll('ytz-datagrid-column'))\r\n    this.innerHTML = ''\r\n    columns.forEach(col => this.appendChild(col))\r\n\r\n    // Create header\r\n    this.#header = document.createElement('div')\r\n    this.#header.className = 'ytz-datagrid-header'\r\n    this.#header.setAttribute('role', 'row')\r\n    this.appendChild(this.#header)\r\n\r\n    // Create viewport for virtual scrolling\r\n    this.#viewport = document.createElement('div')\r\n    this.#viewport.className = 'ytz-datagrid-viewport'\r\n    this.appendChild(this.#viewport)\r\n\r\n    // Create body container\r\n    this.#body = document.createElement('div')\r\n    this.#body.className = 'ytz-datagrid-body'\r\n    this.#body.setAttribute('role', 'rowgroup')\r\n    this.#viewport.appendChild(this.#body)\r\n  }\r\n\r\n  #render() {\r\n    this.#renderHeader()\r\n    this.#applyFiltersAndSort()\r\n    this.#initVirtualScroller()\r\n  }\r\n\r\n  #renderHeader() {\r\n    if (!this.#header) return\r\n\r\n    this.#header.innerHTML = ''\r\n\r\n    this.#columns.forEach((col, index) => {\r\n      const cell = document.createElement('div')\r\n      cell.className = 'ytz-datagrid-header-cell'\r\n      cell.setAttribute('role', 'columnheader')\r\n      cell.setAttribute('data-field', col.field)\r\n\r\n      // Use stored width or fall back to column attribute\r\n      const storedWidth = this.#columnWidths.get(col.field)\r\n      if (storedWidth) {\r\n        cell.style.width = `${storedWidth}px`\r\n        cell.style.flex = 'none'\r\n      } else if (col.width && col.width !== 'auto') {\r\n        cell.style.width = col.width\r\n        cell.style.flex = 'none'\r\n      }\r\n\r\n      // Create content wrapper to keep text separate from resize handle\r\n      const content = document.createElement('span')\r\n      content.className = 'ytz-datagrid-header-content'\r\n      content.textContent = col.header\r\n      cell.appendChild(content)\r\n\r\n      if (col.sortable) {\r\n        cell.classList.add('ytz-datagrid-sortable')\r\n        cell.addEventListener('click', (e) => {\r\n          // Don't sort when clicking resize handle\r\n          if (e.target.classList.contains('ytz-datagrid-resize-handle')) return\r\n          this.#handleSort(col.field)\r\n        })\r\n\r\n        // Add sort indicator\r\n        const indicator = document.createElement('span')\r\n        indicator.className = 'ytz-datagrid-sort-indicator'\r\n        if (this.#sortState?.field === col.field) {\r\n          indicator.textContent = this.#sortState.direction === 'asc' ? ' \\u25B2' : ' \\u25BC'\r\n          cell.setAttribute('aria-sort', this.#sortState.direction === 'asc' ? 'ascending' : 'descending')\r\n        }\r\n        content.appendChild(indicator)\r\n      }\r\n\r\n      if (col.filterable) {\r\n        const input = document.createElement('input')\r\n        input.type = 'text'\r\n        input.className = 'ytz-datagrid-filter'\r\n        input.placeholder = `Filter ${col.header}...`\r\n        input.value = this.#filterState[col.field] || ''\r\n        input.addEventListener('input', (e) => {\r\n          this.#filterState[col.field] = e.target.value\r\n          this.#applyFiltersAndSort()\r\n          this.#initVirtualScroller()\r\n        })\r\n        input.addEventListener('click', (e) => e.stopPropagation())\r\n        cell.appendChild(input)\r\n      }\r\n\r\n      // Add resize handle\r\n      const resizeHandle = document.createElement('div')\r\n      resizeHandle.className = 'ytz-datagrid-resize-handle'\r\n      resizeHandle.addEventListener('mousedown', (e) => this.#handleResizeStart(e, col.field, cell))\r\n      cell.appendChild(resizeHandle)\r\n\r\n      this.#header.appendChild(cell)\r\n    })\r\n  }\r\n\r\n  #handleResizeStart(e, field, headerCell) {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n\r\n    const startX = e.clientX\r\n    const startWidth = headerCell.offsetWidth\r\n\r\n    this.#resizeState = { field, startX, startWidth, headerCell }\r\n\r\n    document.addEventListener('mousemove', this.#handleResizeMove)\r\n    document.addEventListener('mouseup', this.#handleResizeEnd)\r\n\r\n    // Add resizing class for visual feedback\r\n    this.classList.add('ytz-datagrid-resizing')\r\n  }\r\n\r\n  #handleResizeMove = (e) => {\r\n    if (!this.#resizeState) return\r\n\r\n    const { field, startX, startWidth, headerCell } = this.#resizeState\r\n    const delta = e.clientX - startX\r\n    const newWidth = Math.max(50, startWidth + delta) // Minimum 50px\r\n\r\n    // Update header cell width\r\n    headerCell.style.width = `${newWidth}px`\r\n    headerCell.style.flex = 'none'\r\n\r\n    // Update body cells width\r\n    this.#columnWidths.set(field, newWidth)\r\n    this.#updateBodyColumnWidths()\r\n  }\r\n\r\n  #handleResizeEnd = () => {\r\n    if (this.#resizeState) {\r\n      this.dispatchEvent(new CustomEvent('columnresize', {\r\n        bubbles: true,\r\n        detail: {\r\n          field: this.#resizeState.field,\r\n          width: this.#columnWidths.get(this.#resizeState.field)\r\n        }\r\n      }))\r\n    }\r\n\r\n    this.#resizeState = null\r\n    document.removeEventListener('mousemove', this.#handleResizeMove)\r\n    document.removeEventListener('mouseup', this.#handleResizeEnd)\r\n    this.classList.remove('ytz-datagrid-resizing')\r\n  }\r\n\r\n  /**\r\n   * Extract a numeric value from a string, handling currency, percentages, etc.\r\n   * @param {*} value - The value to parse\r\n   * @returns {number|null} - The numeric value or null if not parseable\r\n   */\r\n  #extractNumber(value) {\r\n    if (typeof value === 'number') return value\r\n    if (typeof value !== 'string') return null\r\n\r\n    // Remove currency symbols, commas, spaces, and percentage signs\r\n    const cleaned = value.replace(/[$€£¥,\\s%]/g, '')\r\n\r\n    // Check if it looks like a number (possibly negative, possibly decimal)\r\n    if (!/^-?\\d+\\.?\\d*$/.test(cleaned)) return null\r\n\r\n    const num = parseFloat(cleaned)\r\n    return isNaN(num) ? null : num\r\n  }\r\n\r\n  #updateBodyColumnWidths() {\r\n    const rows = this.querySelectorAll('.ytz-datagrid-row')\r\n    rows.forEach(row => {\r\n      this.#columns.forEach((col, colIndex) => {\r\n        const cell = row.querySelector(`[data-col-index=\"${colIndex}\"]`)\r\n        if (cell) {\r\n          const storedWidth = this.#columnWidths.get(col.field)\r\n          if (storedWidth) {\r\n            cell.style.width = `${storedWidth}px`\r\n            cell.style.flex = 'none'\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  #handleSort(field) {\r\n    if (this.#sortState?.field === field) {\r\n      if (this.#sortState.direction === 'asc') {\r\n        this.#sortState.direction = 'desc'\r\n      } else if (this.#sortState.direction === 'desc') {\r\n        this.#sortState = null\r\n      }\r\n    } else {\r\n      this.#sortState = { field, direction: 'asc' }\r\n    }\r\n\r\n    this.#applyFiltersAndSort()\r\n    this.#renderHeader()\r\n    this.#initVirtualScroller()\r\n\r\n    this.dispatchEvent(new CustomEvent('sort', {\r\n      bubbles: true,\r\n      detail: { ...this.#sortState }\r\n    }))\r\n  }\r\n\r\n  #applyFiltersAndSort() {\r\n    let result = [...this.#data]\r\n\r\n    // Apply filters\r\n    for (const [field, value] of Object.entries(this.#filterState)) {\r\n      if (value) {\r\n        const searchLower = value.toLowerCase()\r\n        result = result.filter(row => {\r\n          const cellValue = String(row[field] ?? '').toLowerCase()\r\n          return cellValue.includes(searchLower)\r\n        })\r\n      }\r\n    }\r\n\r\n    // Apply sort\r\n    if (this.#sortState) {\r\n      const { field, direction } = this.#sortState\r\n      result.sort((a, b) => {\r\n        const aVal = a[field] ?? ''\r\n        const bVal = b[field] ?? ''\r\n\r\n        // Try to extract numeric values (handles currency, percentages, etc.)\r\n        const aNum = this.#extractNumber(aVal)\r\n        const bNum = this.#extractNumber(bVal)\r\n\r\n        let cmp\r\n        if (aNum !== null && bNum !== null) {\r\n          // Both values are numeric - compare as numbers\r\n          cmp = aNum - bNum\r\n        } else {\r\n          // Fall back to string comparison\r\n          cmp = String(aVal).localeCompare(String(bVal), undefined, { numeric: true })\r\n        }\r\n\r\n        return direction === 'asc' ? cmp : -cmp\r\n      })\r\n    }\r\n\r\n    this.#filteredData = result\r\n  }\r\n\r\n  #initVirtualScroller() {\r\n    // Guard: ensure DOM structure is ready\r\n    if (!this.#viewport || !this.#body) return\r\n\r\n    this.#virtualScroller?.destroy()\r\n\r\n    const rowHeight = parseInt(this.getAttribute('row-height')) || 40\r\n\r\n    this.#virtualScroller = createVirtualScroller({\r\n      container: this.#viewport,\r\n      content: this.#body,\r\n      itemCount: this.#filteredData.length,\r\n      itemHeight: rowHeight,\r\n      renderItem: (index) => this.#renderRow(index)\r\n    })\r\n  }\r\n\r\n  #renderRow(index) {\r\n    const rowData = this.#filteredData[index]\r\n    if (!rowData) return null\r\n\r\n    const row = document.createElement('div')\r\n    row.className = 'ytz-datagrid-row'\r\n    row.setAttribute('role', 'row')\r\n    row.setAttribute('data-row-index', String(index))\r\n    row.tabIndex = -1\r\n\r\n    this.#columns.forEach((col, colIndex) => {\r\n      const cell = document.createElement('div')\r\n      cell.className = 'ytz-datagrid-cell'\r\n      cell.setAttribute('role', 'gridcell')\r\n\r\n      // Use stored width or fall back to column attribute\r\n      const storedWidth = this.#columnWidths.get(col.field)\r\n      if (storedWidth) {\r\n        cell.style.width = `${storedWidth}px`\r\n        cell.style.flex = 'none'\r\n      } else if (col.width && col.width !== 'auto') {\r\n        cell.style.width = col.width\r\n        cell.style.flex = 'none'\r\n      }\r\n\r\n      cell.textContent = String(rowData[col.field] ?? '')\r\n      cell.setAttribute('data-col-index', String(colIndex))\r\n      row.appendChild(cell)\r\n    })\r\n\r\n    row.addEventListener('click', (e) => {\r\n      this.#focusedRow = index\r\n      // Determine which cell was clicked\r\n      const cell = e.target.closest('.ytz-datagrid-cell')\r\n      if (cell) {\r\n        const colIndex = parseInt(cell.getAttribute('data-col-index'), 10)\r\n        if (!isNaN(colIndex)) {\r\n          this.#focusedCol = colIndex\r\n        }\r\n      }\r\n      this.#updateFocus()\r\n      this.dispatchEvent(new CustomEvent('rowselect', {\r\n        bubbles: true,\r\n        detail: { row: rowData, index }\r\n      }))\r\n    })\r\n\r\n    return row\r\n  }\r\n\r\n  #handleKeydown = (e) => {\r\n    const maxRow = this.#filteredData.length - 1\r\n    const maxCol = this.#columns.length - 1\r\n\r\n    switch (e.key) {\r\n      case 'ArrowDown':\r\n        e.preventDefault()\r\n        this.#focusedRow = Math.min(maxRow, this.#focusedRow + 1)\r\n        this.#updateFocus()\r\n        break\r\n      case 'ArrowUp':\r\n        e.preventDefault()\r\n        this.#focusedRow = Math.max(0, this.#focusedRow - 1)\r\n        this.#updateFocus()\r\n        break\r\n      case 'ArrowRight':\r\n        e.preventDefault()\r\n        this.#focusedCol = Math.min(maxCol, this.#focusedCol + 1)\r\n        this.#updateFocus()\r\n        break\r\n      case 'ArrowLeft':\r\n        e.preventDefault()\r\n        this.#focusedCol = Math.max(0, this.#focusedCol - 1)\r\n        this.#updateFocus()\r\n        break\r\n      case 'Home':\r\n        e.preventDefault()\r\n        if (e.ctrlKey) {\r\n          this.#focusedRow = 0\r\n        }\r\n        this.#focusedCol = 0\r\n        this.#updateFocus()\r\n        break\r\n      case 'End':\r\n        e.preventDefault()\r\n        if (e.ctrlKey) {\r\n          this.#focusedRow = maxRow\r\n        }\r\n        this.#focusedCol = maxCol\r\n        this.#updateFocus()\r\n        break\r\n      case 'PageDown':\r\n        e.preventDefault()\r\n        this.#focusedRow = Math.min(maxRow, this.#focusedRow + 10)\r\n        this.#updateFocus()\r\n        break\r\n      case 'PageUp':\r\n        e.preventDefault()\r\n        this.#focusedRow = Math.max(0, this.#focusedRow - 10)\r\n        this.#updateFocus()\r\n        break\r\n      case 'Enter':\r\n        e.preventDefault()\r\n        this.dispatchEvent(new CustomEvent('rowactivate', {\r\n          bubbles: true,\r\n          detail: { row: this.#filteredData[this.#focusedRow], index: this.#focusedRow }\r\n        }))\r\n        break\r\n    }\r\n  }\r\n\r\n  #updateFocus() {\r\n    // Scroll row into view via virtual scroller\r\n    this.#virtualScroller?.scrollToIndex(this.#focusedRow)\r\n\r\n    // Apply focus styling after any scroll-triggered re-render completes\r\n    // (scrollToIndex may trigger scroll event → RAF render that clears DOM)\r\n    requestAnimationFrame(() => {\r\n      this.#applyFocusStyling()\r\n    })\r\n  }\r\n\r\n  #applyFocusStyling() {\r\n    // Update row focus styling\r\n    this.querySelectorAll('.ytz-datagrid-row').forEach(row => {\r\n      row.classList.remove('ytz-datagrid-row-focused')\r\n    })\r\n\r\n    const targetRow = this.querySelector(`[data-row-index=\"${this.#focusedRow}\"]`)\r\n    targetRow?.classList.add('ytz-datagrid-row-focused')\r\n\r\n    // Update cell focus\r\n    this.querySelectorAll('.ytz-datagrid-cell').forEach(cell => {\r\n      cell.classList.remove('ytz-datagrid-cell-focused')\r\n    })\r\n\r\n    const targetCell = targetRow?.querySelector(`[data-col-index=\"${this.#focusedCol}\"]`)\r\n    targetCell?.classList.add('ytz-datagrid-cell-focused')\r\n  }\r\n\r\n  /**\r\n   * Export data to CSV format.\r\n   * @returns {string} CSV string\r\n   */\r\n  exportCSV() {\r\n    const headers = this.#columns.map(col => `\"${col.header.replace(/\"/g, '\"\"')}\"`)\r\n    const rows = this.#filteredData.map(row => {\r\n      return this.#columns.map(col => {\r\n        const value = String(row[col.field] ?? '')\r\n        return `\"${value.replace(/\"/g, '\"\"')}\"`\r\n      }).join(',')\r\n    })\r\n    return [headers.join(','), ...rows].join('\\n')\r\n  }\r\n\r\n  /**\r\n   * Download data as CSV file.\r\n   * @param {string} filename - File name (default: 'data.csv')\r\n   */\r\n  downloadCSV(filename = 'data.csv') {\r\n    const csv = this.exportCSV()\r\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })\r\n    const url = URL.createObjectURL(blob)\r\n    const link = document.createElement('a')\r\n    link.href = url\r\n    link.download = filename\r\n    link.click()\r\n    URL.revokeObjectURL(url)\r\n  }\r\n\r\n  // Property accessors\r\n  get data() {\r\n    return this.#data\r\n  }\r\n\r\n  set data(value) {\r\n    this.#data = Array.isArray(value) ? value : []\r\n    this.#applyFiltersAndSort()\r\n    this.#initVirtualScroller()\r\n  }\r\n\r\n  get sortState() {\r\n    return this.#sortState ? { ...this.#sortState } : null\r\n  }\r\n\r\n  get filteredData() {\r\n    return [...this.#filteredData]\r\n  }\r\n}\r\n\r\nregister('ytz-datagrid', YtzDatagrid)\r\n\r\nexport { YtzDatagrid, YtzDatagridColumn }\r\n"]}