function w({container:c,content:t,itemCount:i,itemHeight:e,renderItem:n,buffer:s=5}){let r=0,a={start:0,end:0},l=null,f=i*e;t.style.height=`${f}px`,t.style.position="relative";function u(){let h=c.clientHeight,d=Math.max(0,Math.floor(r/e)-s),o=Math.ceil(h/e),m=Math.min(i,d+o+s*2);return {start:d,end:m}}function p(){let h=u();if(!(h.start===a.start&&h.end===a.end)){a=h,t.innerHTML="";for(let d=h.start;d<h.end;d++){let o=n(d);o&&(o.style.position="absolute",o.style.top=`${d*e}px`,o.style.height=`${e}px`,o.style.left="0",o.style.right="0",t.appendChild(o));}}}function y(){r=c.scrollTop,l&&cancelAnimationFrame(l),l=requestAnimationFrame(p);}function v(h){let d=h*e,o=c.clientHeight,m=c.scrollTop;d<m?c.scrollTop=d:d+e>m+o&&(c.scrollTop=d-o+e);}function E(){c.removeEventListener("scroll",y),l&&cancelAnimationFrame(l),t.innerHTML="";}function A(){let h=i*e;t.style.height=`${h}px`,a={start:0,end:0},p();}return c.addEventListener("scroll",y),p(),{scrollToIndex:v,refresh:A,destroy:E,get renderedRange(){return {...a}}}}var g=class extends HTMLElement{get field(){return this.getAttribute("field")||""}set field(t){this.setAttribute("field",t);}get header(){return this.getAttribute("header")||this.field}set header(t){this.setAttribute("header",t);}get sortable(){return this.hasAttribute("sortable")}set sortable(t){t?this.setAttribute("sortable",""):this.removeAttribute("sortable");}get filterable(){return this.hasAttribute("filterable")}set filterable(t){t?this.setAttribute("filterable",""):this.removeAttribute("filterable");}get width(){return this.getAttribute("width")||"auto"}set width(t){this.setAttribute("width",t);}};customElements.define("ytz-datagrid-column",g);var b=class extends HTMLElement{static observedAttributes=["row-height","page-size"];#m=[];#r=[];#a=[];#e=null;#p={};#c=null;#n=null;#d=null;#o=null;#t=0;#s=0;#h=new Map;#l=null;connectedCallback(){this.#A();}disconnectedCallback(){this.#c?.destroy(),this.removeEventListener("keydown",this.#E),document.removeEventListener("mousemove",this.#g),document.removeEventListener("mouseup",this.#b);}attributeChangedCallback(){this.isConnected&&this.#y();}#A(){this.#a=Array.from(this.querySelectorAll("ytz-datagrid-column")),this.setAttribute("role","grid"),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.#x(),this.addEventListener("keydown",this.#E),this.#y();}#x(){let t=Array.from(this.querySelectorAll("ytz-datagrid-column"));this.innerHTML="",t.forEach(i=>this.appendChild(i)),this.#n=document.createElement("div"),this.#n.className="ytz-datagrid-header",this.#n.setAttribute("role","row"),this.appendChild(this.#n),this.#o=document.createElement("div"),this.#o.className="ytz-datagrid-viewport",this.appendChild(this.#o),this.#d=document.createElement("div"),this.#d.className="ytz-datagrid-body",this.#d.setAttribute("role","rowgroup"),this.#o.appendChild(this.#d);}#y(){this.#w(),this.#u(),this.#f();}#w(){this.#n&&(this.#n.innerHTML="",this.#a.forEach((t,i)=>{let e=document.createElement("div");e.className="ytz-datagrid-header-cell",e.setAttribute("role","columnheader"),e.setAttribute("data-field",t.field);let n=this.#h.get(t.field);n?(e.style.width=`${n}px`,e.style.flex="none"):t.width&&t.width!=="auto"&&(e.style.width=t.width,e.style.flex="none");let s=document.createElement("span");if(s.className="ytz-datagrid-header-content",s.textContent=t.header,e.appendChild(s),t.sortable){e.classList.add("ytz-datagrid-sortable"),e.addEventListener("click",l=>{l.target.classList.contains("ytz-datagrid-resize-handle")||this.#C(t.field);});let a=document.createElement("span");a.className="ytz-datagrid-sort-indicator",this.#e?.field===t.field&&(a.textContent=this.#e.direction==="asc"?" \u25B2":" \u25BC",e.setAttribute("aria-sort",this.#e.direction==="asc"?"ascending":"descending")),s.appendChild(a);}if(t.filterable){let a=document.createElement("input");a.type="text",a.className="ytz-datagrid-filter",a.placeholder=`Filter ${t.header}...`,a.value=this.#p[t.field]||"",a.addEventListener("input",l=>{this.#p[t.field]=l.target.value,this.#u(),this.#f();}),a.addEventListener("click",l=>l.stopPropagation()),e.appendChild(a);}let r=document.createElement("div");r.className="ytz-datagrid-resize-handle",r.addEventListener("mousedown",a=>this.#L(a,t.field,e)),e.appendChild(r),this.#n.appendChild(e);}));}#L(t,i,e){t.preventDefault(),t.stopPropagation();let n=t.clientX,s=e.offsetWidth;this.#l={field:i,startX:n,startWidth:s,headerCell:e},document.addEventListener("mousemove",this.#g),document.addEventListener("mouseup",this.#b),this.classList.add("ytz-datagrid-resizing");}#g=t=>{if(!this.#l)return;let{field:i,startX:e,startWidth:n,headerCell:s}=this.#l,r=t.clientX-e,a=Math.max(50,n+r);s.style.width=`${a}px`,s.style.flex="none",this.#h.set(i,a),this.#z();};#b=()=>{this.#l&&this.dispatchEvent(new CustomEvent("columnresize",{bubbles:true,detail:{field:this.#l.field,width:this.#h.get(this.#l.field)}})),this.#l=null,document.removeEventListener("mousemove",this.#g),document.removeEventListener("mouseup",this.#b),this.classList.remove("ytz-datagrid-resizing");};#v(t){if(typeof t=="number")return t;if(typeof t!="string")return null;let i=t.replace(/[$€£¥,\s%]/g,"");if(!/^-?\d+\.?\d*$/.test(i))return null;let e=parseFloat(i);return isNaN(e)?null:e}#z(){this.querySelectorAll(".ytz-datagrid-row").forEach(i=>{this.#a.forEach((e,n)=>{let s=i.querySelector(`[data-col-index="${n}"]`);if(s){let r=this.#h.get(e.field);r&&(s.style.width=`${r}px`,s.style.flex="none");}});});}#C(t){this.#e?.field===t?this.#e.direction==="asc"?this.#e.direction="desc":this.#e.direction==="desc"&&(this.#e=null):this.#e={field:t,direction:"asc"},this.#u(),this.#w(),this.#f(),this.dispatchEvent(new CustomEvent("sort",{bubbles:true,detail:{...this.#e}}));}#u(){let t=[...this.#m];for(let[i,e]of Object.entries(this.#p))if(e){let n=e.toLowerCase();t=t.filter(s=>String(s[i]??"").toLowerCase().includes(n));}if(this.#e){let{field:i,direction:e}=this.#e;t.sort((n,s)=>{let r=n[i]??"",a=s[i]??"",l=this.#v(r),f=this.#v(a),u;return l!==null&&f!==null?u=l-f:u=String(r).localeCompare(String(a),void 0,{numeric:true}),e==="asc"?u:-u});}this.#r=t;}#f(){if(!this.#o||!this.#d)return;this.#c?.destroy();let t=parseInt(this.getAttribute("row-height"))||40;this.#c=w({container:this.#o,content:this.#d,itemCount:this.#r.length,itemHeight:t,renderItem:i=>this.#S(i)});}#S(t){let i=this.#r[t];if(!i)return null;let e=document.createElement("div");return e.className="ytz-datagrid-row",e.setAttribute("role","row"),e.setAttribute("data-row-index",String(t)),e.tabIndex=-1,this.#a.forEach((n,s)=>{let r=document.createElement("div");r.className="ytz-datagrid-cell",r.setAttribute("role","gridcell");let a=this.#h.get(n.field);a?(r.style.width=`${a}px`,r.style.flex="none"):n.width&&n.width!=="auto"&&(r.style.width=n.width,r.style.flex="none"),r.textContent=String(i[n.field]??""),r.setAttribute("data-col-index",String(s)),e.appendChild(r);}),e.addEventListener("click",n=>{this.#t=t;let s=n.target.closest(".ytz-datagrid-cell");if(s){let r=parseInt(s.getAttribute("data-col-index"),10);isNaN(r)||(this.#s=r);}this.#i(),this.dispatchEvent(new CustomEvent("rowselect",{bubbles:true,detail:{row:i,index:t}}));}),e}#E=t=>{let i=this.#r.length-1,e=this.#a.length-1;switch(t.key){case "ArrowDown":t.preventDefault(),this.#t=Math.min(i,this.#t+1),this.#i();break;case "ArrowUp":t.preventDefault(),this.#t=Math.max(0,this.#t-1),this.#i();break;case "ArrowRight":t.preventDefault(),this.#s=Math.min(e,this.#s+1),this.#i();break;case "ArrowLeft":t.preventDefault(),this.#s=Math.max(0,this.#s-1),this.#i();break;case "Home":t.preventDefault(),t.ctrlKey&&(this.#t=0),this.#s=0,this.#i();break;case "End":t.preventDefault(),t.ctrlKey&&(this.#t=i),this.#s=e,this.#i();break;case "PageDown":t.preventDefault(),this.#t=Math.min(i,this.#t+10),this.#i();break;case "PageUp":t.preventDefault(),this.#t=Math.max(0,this.#t-10),this.#i();break;case "Enter":t.preventDefault(),this.dispatchEvent(new CustomEvent("rowactivate",{bubbles:true,detail:{row:this.#r[this.#t],index:this.#t}}));break}};#i(){this.#c?.scrollToIndex(this.#t),requestAnimationFrame(()=>{this.#k();});}#k(){this.querySelectorAll(".ytz-datagrid-row").forEach(e=>{e.classList.remove("ytz-datagrid-row-focused");});let t=this.querySelector(`[data-row-index="${this.#t}"]`);t?.classList.add("ytz-datagrid-row-focused"),this.querySelectorAll(".ytz-datagrid-cell").forEach(e=>{e.classList.remove("ytz-datagrid-cell-focused");}),t?.querySelector(`[data-col-index="${this.#s}"]`)?.classList.add("ytz-datagrid-cell-focused");}exportCSV(){let t=this.#a.map(e=>`"${e.header.replace(/"/g,'""')}"`),i=this.#r.map(e=>this.#a.map(n=>`"${String(e[n.field]??"").replace(/"/g,'""')}"`).join(","));return [t.join(","),...i].join(`
`)}downloadCSV(t="data.csv"){let i=this.exportCSV(),e=new Blob([i],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download=t,s.click(),URL.revokeObjectURL(n);}get data(){return this.#m}set data(t){this.#m=Array.isArray(t)?t:[],this.#u(),this.#f();}get sortState(){return this.#e?{...this.#e}:null}get filteredData(){return [...this.#r]}};customElements.define("ytz-datagrid",b);export{b as YtzDatagrid,g as YtzDatagridColumn};//# sourceMappingURL=datagrid.js.map
//# sourceMappingURL=datagrid.js.map